<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE TemplateHaskell #-}</span><span>
</span><span id="line-2"></span><span>
</span><span id="line-3"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Interpreter.Result</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-4"></span><span>
</span><span id="line-5"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Analyzer.AnalyzedAst.html"><span class="hs-identifier">Analyzer.AnalyzedAst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Analyzer.AnalyzedAst.html#Function"><span class="hs-identifier">Function</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Analyzer.AnalyzedAst.html#FunctionValue"><span class="hs-identifier">FunctionValue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Analyzer.AnalyzedAst.html#Function"><span class="hs-identifier">Function</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Analyzer.AnalyzedAst.html#Nil"><span class="hs-identifier">Nil</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Analyzer.AnalyzedAst.html#Identifier"><span class="hs-identifier">Identifier</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-6"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Lens</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">At</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">at</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">LensLike'</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">ix</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">makeLenses</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-operator">(^.)</span></span><span class="hs-special">)</span><span>
</span><span id="line-7"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Except</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">ExceptT</span></span><span class="hs-special">)</span><span>
</span><span id="line-8"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.ST</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">ST</span></span><span class="hs-special">)</span><span>
</span><span id="line-9"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.State</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">MonadTrans</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">lift</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">StateT</span></span><span class="hs-special">)</span><span>
</span><span id="line-10"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Map</span></span><span class="hs-special">)</span><span>
</span><span id="line-11"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-12"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.STRef</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">STRef</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">readSTRef</span></span><span class="hs-special">)</span><span>
</span><span id="line-13"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Text</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">unpack</span></span><span class="hs-special">)</span><span>
</span><span id="line-14"></span><span>
</span><span id="line-15"></span><span class="hs-comment">-- * Interpretation result</span><span>
</span><span id="line-16"></span><span>
</span><span id="line-17"></span><span class="hs-comment">-- | Represents the result of interpretation.</span><span>
</span><span id="line-18"></span><span class="hs-keyword">type</span><span> </span><span id="Result"><span class="annot"><a href="Interpreter.Result.html#Result"><span class="hs-identifier hs-var">Result</span></a></span></span><span> </span><span id="local-6989586621679165933"><span class="annot"><a href="#local-6989586621679165933"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621679165932"><span class="annot"><a href="#local-6989586621679165932"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ExceptT</span></span><span> </span><span class="annot"><a href="Interpreter.Result.html#Err"><span class="hs-identifier hs-type">Err</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">StateT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Interpreter.Result.html#Env"><span class="hs-identifier hs-type">Env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679165933"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621679165933"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679165932"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-19"></span><span>
</span><span id="line-20"></span><span id="local-6989586621679166094"><span id="local-6989586621679166095"><span class="annot"><a href="Interpreter.Result.html#lift2"><span class="hs-identifier hs-type">lift2</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621679166095"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679166094"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Interpreter.Result.html#Result"><span class="hs-identifier hs-type">Result</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679166095"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679166094"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-21"></span><span id="lift2"><span class="annot"><span class="annottext">lift2 :: forall s a. ST s a -&gt; Result s a
</span><a href="Interpreter.Result.html#lift2"><span class="hs-identifier hs-var hs-var">lift2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span>
</span><span id="line-22"></span><span>
</span><span id="line-23"></span><span class="hs-comment">-- ** Result value</span><span>
</span><span id="line-24"></span><span>
</span><span id="line-25"></span><span class="hs-keyword">type</span><span> </span><span id="ResultValue"><span class="annot"><a href="Interpreter.Result.html#ResultValue"><span class="hs-identifier hs-var">ResultValue</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="Interpreter.Result.html#Err"><span class="hs-identifier hs-type">Err</span></a></span><span>
</span><span id="line-26"></span><span>
</span><span id="line-27"></span><span class="hs-comment">-- | Represents unsuccessful interpretation.</span><span>
</span><span id="line-28"></span><span class="hs-keyword">data</span><span> </span><span id="Err"><span class="annot"><a href="Interpreter.Result.html#Err"><span class="hs-identifier hs-var">Err</span></a></span></span><span>
</span><span id="line-29"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">-- | Division by zero error.</span><span>
</span><span id="line-30"></span><span>    </span><span id="DivisionByZero"><span class="annot"><a href="Interpreter.Result.html#DivisionByZero"><span class="hs-identifier hs-var">DivisionByZero</span></a></span></span><span>
</span><span id="line-31"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-comment">-- | Index out of bounds error, contains info about index and array length.</span><span>
</span><span id="line-32"></span><span>    </span><span id="IndexOutOfRange"><span class="annot"><a href="Interpreter.Result.html#IndexOutOfRange"><span class="hs-identifier hs-var">IndexOutOfRange</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-33"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-comment">-- | No return error.</span><span>
</span><span id="line-34"></span><span>    </span><span id="NoReturn"><span class="annot"><a href="Interpreter.Result.html#NoReturn"><span class="hs-identifier hs-var">NoReturn</span></a></span></span><span>
</span><span id="line-35"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-comment">-- | Null dereference error (happens when trying to call the `nil` as a regular function).</span><span>
</span><span id="line-36"></span><span>    </span><span id="Npe"><span class="annot"><a href="Interpreter.Result.html#Npe"><span class="hs-identifier hs-var">Npe</span></a></span></span><span>
</span><span id="line-37"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-comment">-- | Panic error (happens when calling `panic` stdlib function).</span><span>
</span><span id="line-38"></span><span>    </span><span id="Panic"><span class="annot"><a href="Interpreter.Result.html#Panic"><span class="hs-identifier hs-var">Panic</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-39"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-comment">-- | Unexpected error, this type of errors must never happen.</span><span>
</span><span id="line-40"></span><span>    </span><span id="UnexpectedError"><span class="annot"><a href="Interpreter.Result.html#UnexpectedError"><span class="hs-identifier hs-var">UnexpectedError</span></a></span></span><span>
</span><span id="line-41"></span><span>
</span><span id="line-42"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679165909"><span id="local-6989586621679165912"><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="Interpreter.Result.html#Err"><span class="hs-identifier hs-type">Err</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-43"></span><span>  </span><span id="local-6989586621679165899"><span class="annot"><span class="annottext">show :: Err -&gt; String
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">show</span></span></span><span> </span><span class="annot"><span class="annottext">Err
</span><a href="Interpreter.Result.html#DivisionByZero"><span class="hs-identifier hs-var">DivisionByZero</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;panic: runtime error: integer divide by zero&quot;</span></span><span>
</span><span id="line-44"></span><span>  </span><span class="annot"><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Interpreter.Result.html#IndexOutOfRange"><span class="hs-identifier hs-type">IndexOutOfRange</span></a></span><span> </span><span id="local-6989586621679165897"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679165897"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621679165896"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679165896"><span class="hs-identifier hs-var">len</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;panic: runtime error: index out of range [&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679165897"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;] with length &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679165896"><span class="hs-identifier hs-var">len</span></a></span><span>
</span><span id="line-45"></span><span>  </span><span class="annot"><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Err
</span><a href="Interpreter.Result.html#NoReturn"><span class="hs-identifier hs-var">NoReturn</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;panic: runtime error: no return&quot;</span></span><span>
</span><span id="line-46"></span><span>  </span><span class="annot"><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Err
</span><a href="Interpreter.Result.html#Npe"><span class="hs-identifier hs-var">Npe</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;panic: runtime error: nil pointer dereference&quot;</span></span><span>
</span><span id="line-47"></span><span>  </span><span class="annot"><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Interpreter.Result.html#Panic"><span class="hs-identifier hs-type">Panic</span></a></span><span> </span><span id="local-6989586621679165895"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679165895"><span class="hs-identifier hs-var">msg</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;panic: &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; String
</span><span class="hs-identifier hs-var">unpack</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679165895"><span class="hs-identifier hs-var">msg</span></a></span><span>
</span><span id="line-48"></span><span>  </span><span class="annot"><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Err
</span><a href="Interpreter.Result.html#UnexpectedError"><span class="hs-identifier hs-var">UnexpectedError</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;panic: unexpected error&quot;</span></span><span>
</span><span id="line-49"></span><span>
</span><span id="line-50"></span><span class="hs-comment">-- ** State</span><span>
</span><span id="line-51"></span><span>
</span><span id="line-52"></span><span class="hs-comment">-- *** Environment</span><span>
</span><span id="line-53"></span><span>
</span><span id="line-54"></span><span class="hs-keyword">data</span><span> </span><span id="Env"><span class="annot"><a href="Interpreter.Result.html#Env"><span class="hs-identifier hs-var">Env</span></a></span></span><span> </span><span id="local-6989586621679166069"><span class="annot"><a href="#local-6989586621679166069"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Env"><span class="annot"><a href="Interpreter.Result.html#Env"><span class="hs-identifier hs-var">Env</span></a></span></span><span>
</span><span id="line-55"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="_funcs"><span class="annot"><span class="annottext">forall s. Env s -&gt; Map Text (STRef s Function, Scope s)
</span><a href="Interpreter.Result.html#_funcs"><span class="hs-identifier hs-var hs-var">_funcs</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="Analyzer.AnalyzedAst.html#Identifier"><span class="hs-identifier hs-type">Identifier</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">STRef</span></span><span> </span><span class="annot"><a href="#local-6989586621679166069"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="Analyzer.AnalyzedAst.html#Function"><span class="hs-identifier hs-type">Function</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Interpreter.Result.html#Scope"><span class="hs-identifier hs-type">Scope</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679166069"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-56"></span><span>    </span><span id="_funcScopes"><span class="annot"><span class="annottext">forall s. Env s -&gt; [FuncScope s]
</span><a href="Interpreter.Result.html#_funcScopes"><span class="hs-identifier hs-var hs-var">_funcScopes</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Interpreter.Result.html#FuncScope"><span class="hs-identifier hs-type">FuncScope</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679166069"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-57"></span><span>    </span><span id="_accumulatedOutput"><span class="annot"><span class="annottext">forall s. Env s -&gt; AccOut
</span><a href="Interpreter.Result.html#_accumulatedOutput"><span class="hs-identifier hs-var hs-var">_accumulatedOutput</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Interpreter.Result.html#AccOut"><span class="hs-identifier hs-type">AccOut</span></a></span><span>
</span><span id="line-58"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-59"></span><span>
</span><span id="line-60"></span><span class="hs-comment">-- | Accumulated output (every element is a text printed to the stdout).</span><span>
</span><span id="line-61"></span><span class="hs-keyword">type</span><span> </span><span id="AccOut"><span class="annot"><a href="Interpreter.Result.html#AccOut"><span class="hs-identifier hs-var">AccOut</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span class="hs-special">]</span><span>
</span><span id="line-62"></span><span>
</span><span id="line-63"></span><span id="local-6989586621679166059"><span class="annot"><a href="Interpreter.Result.html#emptyEnv"><span class="hs-identifier hs-type">emptyEnv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Interpreter.Result.html#Env"><span class="hs-identifier hs-type">Env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679166059"><span class="hs-identifier hs-type">s</span></a></span></span><span>
</span><span id="line-64"></span><span id="emptyEnv"><span class="annot"><span class="annottext">emptyEnv :: forall s. Env s
</span><a href="Interpreter.Result.html#emptyEnv"><span class="hs-identifier hs-var hs-var">emptyEnv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall s.
Map Text (STRef s Function, Scope s)
-&gt; [FuncScope s] -&gt; AccOut -&gt; Env s
</span><a href="Interpreter.Result.html#Env"><span class="hs-identifier hs-var">Env</span></a></span><span> </span><span class="annot"><span class="annottext">forall k a. Map k a
</span><span class="hs-identifier hs-var">Map.empty</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-65"></span><span>
</span><span id="line-66"></span><span class="hs-comment">-- *** Function scope</span><span>
</span><span id="line-67"></span><span>
</span><span id="line-68"></span><span class="hs-keyword">newtype</span><span> </span><span id="FuncScope"><span class="annot"><a href="Interpreter.Result.html#FuncScope"><span class="hs-identifier hs-var">FuncScope</span></a></span></span><span> </span><span id="local-6989586621679166055"><span class="annot"><a href="#local-6989586621679166055"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="FuncScope"><span class="annot"><a href="Interpreter.Result.html#FuncScope"><span class="hs-identifier hs-var">FuncScope</span></a></span></span><span> </span><span class="hs-special">{</span><span id="_scopes"><span class="annot"><span class="annottext">forall s. FuncScope s -&gt; [Scope s]
</span><a href="Interpreter.Result.html#_scopes"><span class="hs-identifier hs-var hs-var">_scopes</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Interpreter.Result.html#Scope"><span class="hs-identifier hs-type">Scope</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679166055"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">]</span><span class="hs-special">}</span><span>
</span><span id="line-69"></span><span>
</span><span id="line-70"></span><span class="hs-comment">-- *** Scope</span><span>
</span><span id="line-71"></span><span>
</span><span id="line-72"></span><span class="hs-comment">-- | Scope contains identifiers mapped to their types.</span><span>
</span><span id="line-73"></span><span class="hs-keyword">newtype</span><span> </span><span id="Scope"><span class="annot"><a href="Interpreter.Result.html#Scope"><span class="hs-identifier hs-var">Scope</span></a></span></span><span> </span><span id="local-6989586621679166053"><span class="annot"><a href="#local-6989586621679166053"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Scope"><span class="annot"><a href="Interpreter.Result.html#Scope"><span class="hs-identifier hs-var">Scope</span></a></span></span><span> </span><span class="hs-special">{</span><span id="_vars"><span class="annot"><span class="annottext">forall s. Scope s -&gt; Map Text (STRef s (RuntimeValue s))
</span><a href="Interpreter.Result.html#_vars"><span class="hs-identifier hs-var hs-var">_vars</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="Analyzer.AnalyzedAst.html#Identifier"><span class="hs-identifier hs-type">Identifier</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">STRef</span></span><span> </span><span class="annot"><a href="#local-6989586621679166053"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Interpreter.Result.html#RuntimeValue"><span class="hs-identifier hs-type">RuntimeValue</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679166053"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">}</span><span>
</span><span id="line-74"></span><span>
</span><span id="line-75"></span><span class="hs-comment">-- | Create empty 'Scope'.</span><span>
</span><span id="line-76"></span><span id="local-6989586621679166051"><span class="annot"><a href="Interpreter.Result.html#emptyScope"><span class="hs-identifier hs-type">emptyScope</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Interpreter.Result.html#Scope"><span class="hs-identifier hs-type">Scope</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679166051"><span class="hs-identifier hs-type">s</span></a></span></span><span>
</span><span id="line-77"></span><span id="emptyScope"><span class="annot"><span class="annottext">emptyScope :: forall s. Scope s
</span><a href="Interpreter.Result.html#emptyScope"><span class="hs-identifier hs-var hs-var">emptyScope</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall s. Map Text (STRef s (RuntimeValue s)) -&gt; Scope s
</span><a href="Interpreter.Result.html#Scope"><span class="hs-identifier hs-var">Scope</span></a></span><span> </span><span class="annot"><span class="annottext">forall k a. Map k a
</span><span class="hs-identifier hs-var">Map.empty</span></span><span>
</span><span id="line-78"></span><span>
</span><span id="line-79"></span><span class="hs-comment">-- *** Runtime value</span><span>
</span><span id="line-80"></span><span>
</span><span id="line-81"></span><span class="hs-comment">-- | Represents runtime value of the calculated expression.</span><span>
</span><span id="line-82"></span><span class="hs-keyword">data</span><span> </span><span id="RuntimeValue"><span class="annot"><a href="Interpreter.Result.html#RuntimeValue"><span class="hs-identifier hs-var">RuntimeValue</span></a></span></span><span> </span><span id="local-6989586621679165969"><span class="annot"><a href="#local-6989586621679165969"><span class="hs-identifier hs-type">s</span></a></span></span><span>
</span><span id="line-83"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">-- | Int value.</span><span>
</span><span id="line-84"></span><span>    </span><span id="ValInt"><span class="annot"><a href="Interpreter.Result.html#ValInt"><span class="hs-identifier hs-var">ValInt</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-85"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-comment">-- | Boolean value.</span><span>
</span><span id="line-86"></span><span>    </span><span id="ValBool"><span class="annot"><a href="Interpreter.Result.html#ValBool"><span class="hs-identifier hs-var">ValBool</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-87"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-comment">-- | String value.</span><span>
</span><span id="line-88"></span><span>    </span><span id="ValString"><span class="annot"><a href="Interpreter.Result.html#ValString"><span class="hs-identifier hs-var">ValString</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-89"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-comment">-- | Array value.</span><span>
</span><span id="line-90"></span><span>    </span><span id="ValArray"><span class="annot"><a href="Interpreter.Result.html#ValArray"><span class="hs-identifier hs-var">ValArray</span></a></span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Interpreter.Result.html#RuntimeValue"><span class="hs-identifier hs-type">RuntimeValue</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679165969"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-91"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-comment">-- | Function value.</span><span>
</span><span id="line-92"></span><span>    </span><span id="ValFunction"><span class="annot"><a href="Interpreter.Result.html#ValFunction"><span class="hs-identifier hs-var">ValFunction</span></a></span></span><span> </span><span class="annot"><a href="Analyzer.AnalyzedAst.html#FunctionValue"><span class="hs-identifier hs-type">FunctionValue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Interpreter.Result.html#Scope"><span class="hs-identifier hs-type">Scope</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679165969"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-93"></span><span>
</span><span id="line-94"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679165876"><span id="local-6989586621679166049"><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Interpreter.Result.html#RuntimeValue"><span class="hs-identifier hs-type">RuntimeValue</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679166049"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-95"></span><span>  </span><span class="annot"><a href="Interpreter.Result.html#ValInt"><span class="hs-identifier hs-type">ValInt</span></a></span><span> </span><span id="local-6989586621679165865"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679165865"><span class="hs-identifier hs-var">lhs</span></a></span></span><span> </span><span id="local-6989586621679165864"><span class="annot"><span class="annottext">== :: RuntimeValue s -&gt; RuntimeValue s -&gt; Bool
</span><span class="hs-operator hs-var hs-var hs-var hs-var">==</span></span></span><span> </span><span class="annot"><a href="Interpreter.Result.html#ValInt"><span class="hs-identifier hs-type">ValInt</span></a></span><span> </span><span id="local-6989586621679165863"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679165863"><span class="hs-identifier hs-var">rhs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679165865"><span class="hs-identifier hs-var">lhs</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679165863"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-96"></span><span>  </span><span class="annot"><a href="Interpreter.Result.html#ValBool"><span class="hs-identifier hs-type">ValBool</span></a></span><span> </span><span id="local-6989586621679165862"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679165862"><span class="hs-identifier hs-var">lhs</span></a></span></span><span> </span><span class="annot"><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><a href="Interpreter.Result.html#ValBool"><span class="hs-identifier hs-type">ValBool</span></a></span><span> </span><span id="local-6989586621679165861"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679165861"><span class="hs-identifier hs-var">rhs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679165862"><span class="hs-identifier hs-var">lhs</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679165861"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-97"></span><span>  </span><span class="annot"><a href="Interpreter.Result.html#ValString"><span class="hs-identifier hs-type">ValString</span></a></span><span> </span><span id="local-6989586621679165860"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679165860"><span class="hs-identifier hs-var">lhs</span></a></span></span><span> </span><span class="annot"><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><a href="Interpreter.Result.html#ValString"><span class="hs-identifier hs-type">ValString</span></a></span><span> </span><span id="local-6989586621679165859"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679165859"><span class="hs-identifier hs-var">rhs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679165860"><span class="hs-identifier hs-var">lhs</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679165859"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-98"></span><span>  </span><span class="annot"><a href="Interpreter.Result.html#ValArray"><span class="hs-identifier hs-type">ValArray</span></a></span><span> </span><span id="local-6989586621679165858"><span class="annot"><span class="annottext">[RuntimeValue s]
</span><a href="#local-6989586621679165858"><span class="hs-identifier hs-var">lhs</span></a></span></span><span> </span><span class="annot"><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><a href="Interpreter.Result.html#ValArray"><span class="hs-identifier hs-type">ValArray</span></a></span><span> </span><span id="local-6989586621679165857"><span class="annot"><span class="annottext">[RuntimeValue s]
</span><a href="#local-6989586621679165857"><span class="hs-identifier hs-var">rhs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[RuntimeValue s]
</span><a href="#local-6989586621679165858"><span class="hs-identifier hs-var">lhs</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">[RuntimeValue s]
</span><a href="#local-6989586621679165857"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-99"></span><span>  </span><span class="annot"><a href="Interpreter.Result.html#ValFunction"><span class="hs-identifier hs-type">ValFunction</span></a></span><span> </span><span class="annot"><span class="annottext">FunctionValue
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Scope s
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><a href="Interpreter.Result.html#ValFunction"><span class="hs-identifier hs-type">ValFunction</span></a></span><span> </span><span class="annot"><span class="annottext">FunctionValue
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Scope s
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-100"></span><span>  </span><span class="annot"><span class="annottext">RuntimeValue s
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">RuntimeValue s
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-101"></span><span>
</span><span id="line-102"></span><span class="hs-comment">-- *** Optics</span><span>
</span><span id="line-103"></span><span>
</span><span id="line-104"></span><span id="funcs"><span id="funcScopes"><span id="accumulatedOutput"><span id="local-6989586621679166069"><span class="hs-identifier">makeLenses</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">Env</span></span></span></span></span><span>
</span><span id="line-105"></span><span id="scopes"><span id="local-6989586621679166036"><span id="local-6989586621679166055"><span class="hs-identifier">makeLenses</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">FuncScope</span></span></span></span><span>
</span><span id="line-106"></span><span id="vars"><span id="local-6989586621679166026"><span id="local-6989586621679166053"><span class="hs-identifier">makeLenses</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">Scope</span></span></span></span><span>
</span><span id="line-107"></span><span>
</span><span id="line-108"></span><span id="local-6989586621679166021"><span id="local-6989586621679166022"><span class="annot"><a href="Interpreter.Result.html#var"><span class="hs-identifier hs-type">var</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Applicative</span></span><span> </span><span class="annot"><a href="#local-6989586621679166022"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Analyzer.AnalyzedAst.html#Identifier"><span class="hs-identifier hs-type">Identifier</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">LensLike'</span></span><span> </span><span class="annot"><a href="#local-6989586621679166022"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Interpreter.Result.html#Env"><span class="hs-identifier hs-type">Env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679166021"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">STRef</span></span><span> </span><span class="annot"><a href="#local-6989586621679166021"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Interpreter.Result.html#RuntimeValue"><span class="hs-identifier hs-type">RuntimeValue</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679166021"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-109"></span><span id="var"><span class="annot"><span class="annottext">var :: forall (f :: * -&gt; *) s.
Applicative f =&gt;
Int
-&gt; Int
-&gt; Text
-&gt; LensLike' f (Env s) (Maybe (STRef s (RuntimeValue s)))
</span><a href="Interpreter.Result.html#var"><span class="hs-identifier hs-var hs-var">var</span></a></span></span><span> </span><span id="local-6989586621679165799"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679165799"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621679165798"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679165798"><span class="hs-identifier hs-var">j</span></a></span></span><span> </span><span id="local-6989586621679165797"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679165797"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall s. Lens' (Env s) [FuncScope s]
</span><a href="Interpreter.Result.html#funcScopes"><span class="hs-identifier hs-var">funcScopes</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall m. Ixed m =&gt; Index m -&gt; Traversal' m (IxValue m)
</span><span class="hs-identifier hs-var">ix</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679165799"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall s s. Iso (FuncScope s) (FuncScope s) [Scope s] [Scope s]
</span><a href="Interpreter.Result.html#scopes"><span class="hs-identifier hs-var">scopes</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall m. Ixed m =&gt; Index m -&gt; Traversal' m (IxValue m)
</span><span class="hs-identifier hs-var">ix</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679165798"><span class="hs-identifier hs-var">j</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall s s.
Iso
  (Scope s)
  (Scope s)
  (Map Text (STRef s (RuntimeValue s)))
  (Map Text (STRef s (RuntimeValue s)))
</span><a href="Interpreter.Result.html#vars"><span class="hs-identifier hs-var">vars</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall m. At m =&gt; Index m -&gt; Lens' m (Maybe (IxValue m))
</span><span class="hs-identifier hs-var">at</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679165797"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-110"></span><span>
</span><span id="line-111"></span><span class="hs-comment">-- ** Evaluated state</span><span>
</span><span id="line-112"></span><span>
</span><span id="line-113"></span><span class="hs-comment">-- *** Environment</span><span>
</span><span id="line-114"></span><span>
</span><span id="line-115"></span><span class="hs-keyword">data</span><span> </span><span id="Env%27"><span class="annot"><a href="Interpreter.Result.html#Env%27"><span class="hs-identifier hs-var">Env'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Env%27"><span class="annot"><a href="Interpreter.Result.html#Env%27"><span class="hs-identifier hs-var">Env'</span></a></span></span><span>
</span><span id="line-116"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="_funcs%27"><span class="annot"><span class="annottext">Env' -&gt; Map Text Function
</span><a href="Interpreter.Result.html#_funcs%27"><span class="hs-identifier hs-var hs-var">_funcs'</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="Analyzer.AnalyzedAst.html#Identifier"><span class="hs-identifier hs-type">Identifier</span></a></span><span> </span><span class="annot"><a href="Analyzer.AnalyzedAst.html#Function"><span class="hs-identifier hs-type">Function</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-117"></span><span>    </span><span id="_funcScopes%27"><span class="annot"><span class="annottext">Env' -&gt; [FuncScope']
</span><a href="Interpreter.Result.html#_funcScopes%27"><span class="hs-identifier hs-var hs-var">_funcScopes'</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Interpreter.Result.html#FuncScope%27"><span class="hs-identifier hs-type">FuncScope'</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-118"></span><span>    </span><span id="_accumulatedOutput%27"><span class="annot"><span class="annottext">Env' -&gt; AccOut
</span><a href="Interpreter.Result.html#_accumulatedOutput%27"><span class="hs-identifier hs-var hs-var">_accumulatedOutput'</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Interpreter.Result.html#AccOut"><span class="hs-identifier hs-type">AccOut</span></a></span><span>
</span><span id="line-119"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-120"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679165777"><span id="local-6989586621679165779"><span id="local-6989586621679165791"><span class="annot"><span class="annottext">Int -&gt; Env' -&gt; ShowS
[Env'] -&gt; ShowS
Env' -&gt; String
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [Env'] -&gt; ShowS
$cshowList :: [Env'] -&gt; ShowS
show :: Env' -&gt; String
$cshow :: Env' -&gt; String
showsPrec :: Int -&gt; Env' -&gt; ShowS
$cshowsPrec :: Int -&gt; Env' -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-121"></span><span>
</span><span id="line-122"></span><span id="local-6989586621679166003"><span class="annot"><a href="Interpreter.Result.html#evalEnv"><span class="hs-identifier hs-type">evalEnv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Interpreter.Result.html#Env"><span class="hs-identifier hs-type">Env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679166003"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621679166003"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="Interpreter.Result.html#Env%27"><span class="hs-identifier hs-type">Env'</span></a></span></span><span>
</span><span id="line-123"></span><span id="evalEnv"><span class="annot"><span class="annottext">evalEnv :: forall s. Env s -&gt; ST s Env'
</span><a href="Interpreter.Result.html#evalEnv"><span class="hs-identifier hs-var hs-var">evalEnv</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Interpreter.Result.html#Env"><span class="hs-identifier hs-type">Env</span></a></span><span> </span><span id="local-6989586621679165764"><span class="annot"><span class="annottext">Map Text (STRef s Function, Scope s)
</span><a href="#local-6989586621679165764"><span class="hs-identifier hs-var">fs</span></a></span></span><span> </span><span id="local-6989586621679165763"><span class="annot"><span class="annottext">[FuncScope s]
</span><a href="#local-6989586621679165763"><span class="hs-identifier hs-var">fScs</span></a></span></span><span> </span><span id="local-6989586621679165762"><span class="annot"><span class="annottext">AccOut
</span><a href="#local-6989586621679165762"><span class="hs-identifier hs-var">accOut</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-124"></span><span>  </span><span id="local-6989586621679165761"><span class="annot"><span class="annottext">Map Text Function
</span><a href="#local-6989586621679165761"><span class="hs-identifier hs-var">fs'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall s a. STRef s a -&gt; ST s a
</span><span class="hs-identifier hs-var">readSTRef</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map Text (STRef s Function, Scope s)
</span><a href="#local-6989586621679165764"><span class="hs-identifier hs-var">fs</span></a></span><span>
</span><span id="line-125"></span><span>  </span><span id="local-6989586621679165759"><span class="annot"><span class="annottext">[FuncScope']
</span><a href="#local-6989586621679165759"><span class="hs-identifier hs-var">fScs'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">forall s. FuncScope s -&gt; ST s FuncScope'
</span><a href="Interpreter.Result.html#evalFuncScope"><span class="hs-identifier hs-var">evalFuncScope</span></a></span><span> </span><span class="annot"><span class="annottext">[FuncScope s]
</span><a href="#local-6989586621679165763"><span class="hs-identifier hs-var">fScs</span></a></span><span>
</span><span id="line-126"></span><span>  </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Map Text Function -&gt; [FuncScope'] -&gt; AccOut -&gt; Env'
</span><a href="Interpreter.Result.html#Env%27"><span class="hs-identifier hs-var">Env'</span></a></span><span> </span><span class="annot"><span class="annottext">Map Text Function
</span><a href="#local-6989586621679165761"><span class="hs-identifier hs-var">fs'</span></a></span><span> </span><span class="annot"><span class="annottext">[FuncScope']
</span><a href="#local-6989586621679165759"><span class="hs-identifier hs-var">fScs'</span></a></span><span> </span><span class="annot"><span class="annottext">AccOut
</span><a href="#local-6989586621679165762"><span class="hs-identifier hs-var">accOut</span></a></span><span>
</span><span id="line-127"></span><span>
</span><span id="line-128"></span><span class="hs-comment">-- *** Function scope</span><span>
</span><span id="line-129"></span><span>
</span><span id="line-130"></span><span class="hs-keyword">newtype</span><span> </span><span id="FuncScope%27"><span class="annot"><a href="Interpreter.Result.html#FuncScope%27"><span class="hs-identifier hs-var">FuncScope'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="FuncScope%27"><span class="annot"><a href="Interpreter.Result.html#FuncScope%27"><span class="hs-identifier hs-var">FuncScope'</span></a></span></span><span> </span><span class="hs-special">{</span><span id="_scopes%27"><span class="annot"><span class="annottext">FuncScope' -&gt; [Scope']
</span><a href="Interpreter.Result.html#_scopes%27"><span class="hs-identifier hs-var hs-var">_scopes'</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Interpreter.Result.html#Scope%27"><span class="hs-identifier hs-type">Scope'</span></a></span><span class="hs-special">]</span><span class="hs-special">}</span><span>
</span><span id="line-131"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679165747"><span id="local-6989586621679165749"><span id="local-6989586621679165754"><span class="annot"><span class="annottext">Int -&gt; FuncScope' -&gt; ShowS
[FuncScope'] -&gt; ShowS
FuncScope' -&gt; String
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [FuncScope'] -&gt; ShowS
$cshowList :: [FuncScope'] -&gt; ShowS
show :: FuncScope' -&gt; String
$cshow :: FuncScope' -&gt; String
showsPrec :: Int -&gt; FuncScope' -&gt; ShowS
$cshowsPrec :: Int -&gt; FuncScope' -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-132"></span><span>
</span><span id="line-133"></span><span id="local-6989586621679165992"><span class="annot"><a href="Interpreter.Result.html#evalFuncScope"><span class="hs-identifier hs-type">evalFuncScope</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Interpreter.Result.html#FuncScope"><span class="hs-identifier hs-type">FuncScope</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679165992"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621679165992"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="Interpreter.Result.html#FuncScope%27"><span class="hs-identifier hs-type">FuncScope'</span></a></span></span><span>
</span><span id="line-134"></span><span id="evalFuncScope"><span class="annot"><span class="annottext">evalFuncScope :: forall s. FuncScope s -&gt; ST s FuncScope'
</span><a href="Interpreter.Result.html#evalFuncScope"><span class="hs-identifier hs-var hs-var">evalFuncScope</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Interpreter.Result.html#FuncScope"><span class="hs-identifier hs-type">FuncScope</span></a></span><span> </span><span id="local-6989586621679165742"><span class="annot"><span class="annottext">[Scope s]
</span><a href="#local-6989586621679165742"><span class="hs-identifier hs-var">scs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Scope'] -&gt; FuncScope'
</span><a href="Interpreter.Result.html#FuncScope%27"><span class="hs-identifier hs-var">FuncScope'</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">forall s. Scope s -&gt; ST s Scope'
</span><a href="Interpreter.Result.html#evalScope"><span class="hs-identifier hs-var">evalScope</span></a></span><span> </span><span class="annot"><span class="annottext">[Scope s]
</span><a href="#local-6989586621679165742"><span class="hs-identifier hs-var">scs</span></a></span><span>
</span><span id="line-135"></span><span>
</span><span id="line-136"></span><span class="hs-comment">-- *** Scope</span><span>
</span><span id="line-137"></span><span>
</span><span id="line-138"></span><span class="hs-keyword">newtype</span><span> </span><span id="Scope%27"><span class="annot"><a href="Interpreter.Result.html#Scope%27"><span class="hs-identifier hs-var">Scope'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Scope%27"><span class="annot"><a href="Interpreter.Result.html#Scope%27"><span class="hs-identifier hs-var">Scope'</span></a></span></span><span> </span><span class="hs-special">{</span><span id="_vars%27"><span class="annot"><span class="annottext">Scope' -&gt; Map Text RuntimeValue'
</span><a href="Interpreter.Result.html#_vars%27"><span class="hs-identifier hs-var hs-var">_vars'</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="Analyzer.AnalyzedAst.html#Identifier"><span class="hs-identifier hs-type">Identifier</span></a></span><span> </span><span class="annot"><a href="Interpreter.Result.html#RuntimeValue%27"><span class="hs-identifier hs-type">RuntimeValue'</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-139"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679165728"><span id="local-6989586621679165730"><span id="local-6989586621679165736"><span class="annot"><span class="annottext">Int -&gt; Scope' -&gt; ShowS
[Scope'] -&gt; ShowS
Scope' -&gt; String
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [Scope'] -&gt; ShowS
$cshowList :: [Scope'] -&gt; ShowS
show :: Scope' -&gt; String
$cshow :: Scope' -&gt; String
showsPrec :: Int -&gt; Scope' -&gt; ShowS
$cshowsPrec :: Int -&gt; Scope' -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-140"></span><span>
</span><span id="line-141"></span><span id="local-6989586621679165981"><span class="annot"><a href="Interpreter.Result.html#evalScope"><span class="hs-identifier hs-type">evalScope</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Interpreter.Result.html#Scope"><span class="hs-identifier hs-type">Scope</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679165981"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621679165981"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="Interpreter.Result.html#Scope%27"><span class="hs-identifier hs-type">Scope'</span></a></span></span><span>
</span><span id="line-142"></span><span id="evalScope"><span class="annot"><span class="annottext">evalScope :: forall s. Scope s -&gt; ST s Scope'
</span><a href="Interpreter.Result.html#evalScope"><span class="hs-identifier hs-var hs-var">evalScope</span></a></span></span><span> </span><span id="local-6989586621679165720"><span class="annot"><span class="annottext">Scope s
</span><a href="#local-6989586621679165720"><span class="hs-identifier hs-var">sc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map Text RuntimeValue' -&gt; Scope'
</span><a href="Interpreter.Result.html#Scope%27"><span class="hs-identifier hs-var">Scope'</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">forall s. RuntimeValue s -&gt; RuntimeValue'
</span><a href="Interpreter.Result.html#evalRuntimeValue"><span class="hs-identifier hs-var">evalRuntimeValue</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall s a. STRef s a -&gt; ST s a
</span><span class="hs-identifier hs-var">readSTRef</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Scope s
</span><a href="#local-6989586621679165720"><span class="hs-identifier hs-var">sc</span></a></span><span> </span><span class="annot"><span class="annottext">forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">forall s s.
Iso
  (Scope s)
  (Scope s)
  (Map Text (STRef s (RuntimeValue s)))
  (Map Text (STRef s (RuntimeValue s)))
</span><a href="Interpreter.Result.html#vars"><span class="hs-identifier hs-var">vars</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-143"></span><span>
</span><span id="line-144"></span><span class="hs-comment">-- *** Runtime value</span><span>
</span><span id="line-145"></span><span>
</span><span id="line-146"></span><span class="hs-comment">-- | Represents runtime value of the calculated expression.</span><span>
</span><span id="line-147"></span><span class="hs-keyword">data</span><span> </span><span id="RuntimeValue%27"><span class="annot"><a href="Interpreter.Result.html#RuntimeValue%27"><span class="hs-identifier hs-var">RuntimeValue'</span></a></span></span><span>
</span><span id="line-148"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">-- | Int value.</span><span>
</span><span id="line-149"></span><span>    </span><span id="ValInt%27"><span class="annot"><a href="Interpreter.Result.html#ValInt%27"><span class="hs-identifier hs-var">ValInt'</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-150"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-comment">-- | Boolean value.</span><span>
</span><span id="line-151"></span><span>    </span><span id="ValBool%27"><span class="annot"><a href="Interpreter.Result.html#ValBool%27"><span class="hs-identifier hs-var">ValBool'</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-152"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-comment">-- | String value.</span><span>
</span><span id="line-153"></span><span>    </span><span id="ValString%27"><span class="annot"><a href="Interpreter.Result.html#ValString%27"><span class="hs-identifier hs-var">ValString'</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-154"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-comment">-- | Array value.</span><span>
</span><span id="line-155"></span><span>    </span><span id="ValArray%27"><span class="annot"><a href="Interpreter.Result.html#ValArray%27"><span class="hs-identifier hs-var">ValArray'</span></a></span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Interpreter.Result.html#RuntimeValue%27"><span class="hs-identifier hs-type">RuntimeValue'</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-156"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-comment">-- | Function value.</span><span>
</span><span id="line-157"></span><span>    </span><span id="ValFunction%27"><span class="annot"><a href="Interpreter.Result.html#ValFunction%27"><span class="hs-identifier hs-var">ValFunction'</span></a></span></span><span> </span><span class="annot"><a href="Analyzer.AnalyzedAst.html#FunctionValue"><span class="hs-identifier hs-type">FunctionValue</span></a></span><span>
</span><span id="line-158"></span><span>
</span><span id="line-159"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679165709"><span id="local-6989586621679165712"><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="Interpreter.Result.html#RuntimeValue%27"><span class="hs-identifier hs-type">RuntimeValue'</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-160"></span><span>  </span><span id="local-6989586621679165702"><span class="annot"><span class="annottext">show :: RuntimeValue' -&gt; String
</span><a href="#local-6989586621679165702"><span class="hs-identifier hs-var hs-var hs-var hs-var">show</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Interpreter.Result.html#ValInt%27"><span class="hs-identifier hs-type">ValInt'</span></a></span><span> </span><span id="local-6989586621679165701"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679165701"><span class="hs-identifier hs-var">int</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679165701"><span class="hs-identifier hs-var">int</span></a></span><span>
</span><span id="line-161"></span><span>  </span><span class="annot"><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Interpreter.Result.html#ValBool%27"><span class="hs-identifier hs-type">ValBool'</span></a></span><span> </span><span id="local-6989586621679165700"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679165700"><span class="hs-identifier hs-var">bool</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679165700"><span class="hs-identifier hs-var">bool</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;true&quot;</span></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;false&quot;</span></span><span>
</span><span id="line-162"></span><span>  </span><span class="annot"><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Interpreter.Result.html#ValString%27"><span class="hs-identifier hs-type">ValString'</span></a></span><span> </span><span id="local-6989586621679165699"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679165699"><span class="hs-identifier hs-var">string</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; String
</span><span class="hs-identifier hs-var">unpack</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679165699"><span class="hs-identifier hs-var">string</span></a></span><span>
</span><span id="line-163"></span><span>  </span><span class="annot"><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Interpreter.Result.html#ValArray%27"><span class="hs-identifier hs-type">ValArray'</span></a></span><span> </span><span id="local-6989586621679165698"><span class="annot"><span class="annottext">[RuntimeValue']
</span><a href="#local-6989586621679165698"><span class="hs-identifier hs-var">vs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;[&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[String] -&gt; String
</span><span class="hs-identifier hs-var">unwords</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[RuntimeValue']
</span><a href="#local-6989586621679165698"><span class="hs-identifier hs-var">vs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;]&quot;</span></span><span>
</span><span id="line-164"></span><span>  </span><span class="annot"><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Interpreter.Result.html#ValFunction%27"><span class="hs-identifier hs-type">ValFunction'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Analyzer.AnalyzedAst.html#Function"><span class="hs-identifier hs-type">Function</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Analyzer.AnalyzedAst.html#FuncOrdinary"><span class="hs-identifier hs-type">FuncOrdinary</span></a></span><span> </span><span class="annot"><span class="annottext">OrdinaryFunction
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;function&quot;</span></span><span>
</span><span id="line-165"></span><span>  </span><span class="annot"><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Interpreter.Result.html#ValFunction%27"><span class="hs-identifier hs-type">ValFunction'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Analyzer.AnalyzedAst.html#Function"><span class="hs-identifier hs-type">Function</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Analyzer.AnalyzedAst.html#FuncStdLib"><span class="hs-identifier hs-type">FuncStdLib</span></a></span><span> </span><span id="local-6989586621679165694"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679165694"><span class="hs-identifier hs-var">name</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; String
</span><span class="hs-identifier hs-var">unpack</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679165694"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-166"></span><span>  </span><span class="annot"><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Interpreter.Result.html#ValFunction%27"><span class="hs-identifier hs-type">ValFunction'</span></a></span><span> </span><span class="annot"><span class="annottext">FunctionValue
</span><a href="Analyzer.AnalyzedAst.html#Nil"><span class="hs-identifier hs-var">Nil</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;nil&quot;</span></span><span>
</span><span id="line-167"></span><span>
</span><span id="line-168"></span><span id="local-6989586621679165977"><span class="annot"><a href="Interpreter.Result.html#evalRuntimeValue"><span class="hs-identifier hs-type">evalRuntimeValue</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Interpreter.Result.html#RuntimeValue"><span class="hs-identifier hs-type">RuntimeValue</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679165977"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Interpreter.Result.html#RuntimeValue%27"><span class="hs-identifier hs-type">RuntimeValue'</span></a></span></span><span>
</span><span id="line-169"></span><span id="evalRuntimeValue"><span class="annot"><span class="annottext">evalRuntimeValue :: forall s. RuntimeValue s -&gt; RuntimeValue'
</span><a href="Interpreter.Result.html#evalRuntimeValue"><span class="hs-identifier hs-var hs-var">evalRuntimeValue</span></a></span></span><span> </span><span id="local-6989586621679165692"><span class="annot"><span class="annottext">RuntimeValue s
</span><a href="#local-6989586621679165692"><span class="hs-identifier hs-var">rv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">RuntimeValue s
</span><a href="#local-6989586621679165692"><span class="hs-identifier hs-var">rv</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-170"></span><span>  </span><span class="annot"><a href="Interpreter.Result.html#ValInt"><span class="hs-identifier hs-type">ValInt</span></a></span><span> </span><span id="local-6989586621679165691"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679165691"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; RuntimeValue'
</span><a href="Interpreter.Result.html#ValInt%27"><span class="hs-identifier hs-var">ValInt'</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679165691"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-171"></span><span>  </span><span class="annot"><a href="Interpreter.Result.html#ValBool"><span class="hs-identifier hs-type">ValBool</span></a></span><span> </span><span id="local-6989586621679165690"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679165690"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; RuntimeValue'
</span><a href="Interpreter.Result.html#ValBool%27"><span class="hs-identifier hs-var">ValBool'</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679165690"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-172"></span><span>  </span><span class="annot"><a href="Interpreter.Result.html#ValString"><span class="hs-identifier hs-type">ValString</span></a></span><span> </span><span id="local-6989586621679165689"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679165689"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text -&gt; RuntimeValue'
</span><a href="Interpreter.Result.html#ValString%27"><span class="hs-identifier hs-var">ValString'</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679165689"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-173"></span><span>  </span><span class="annot"><a href="Interpreter.Result.html#ValArray"><span class="hs-identifier hs-type">ValArray</span></a></span><span> </span><span id="local-6989586621679165688"><span class="annot"><span class="annottext">[RuntimeValue s]
</span><a href="#local-6989586621679165688"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[RuntimeValue'] -&gt; RuntimeValue'
</span><a href="Interpreter.Result.html#ValArray%27"><span class="hs-identifier hs-var">ValArray'</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall s. RuntimeValue s -&gt; RuntimeValue'
</span><a href="Interpreter.Result.html#evalRuntimeValue"><span class="hs-identifier hs-var">evalRuntimeValue</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[RuntimeValue s]
</span><a href="#local-6989586621679165688"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-174"></span><span>  </span><span class="annot"><a href="Interpreter.Result.html#ValFunction"><span class="hs-identifier hs-type">ValFunction</span></a></span><span> </span><span id="local-6989586621679165687"><span class="annot"><span class="annottext">FunctionValue
</span><a href="#local-6989586621679165687"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="annot"><span class="annottext">Scope s
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FunctionValue -&gt; RuntimeValue'
</span><a href="Interpreter.Result.html#ValFunction%27"><span class="hs-identifier hs-var">ValFunction'</span></a></span><span> </span><span class="annot"><span class="annottext">FunctionValue
</span><a href="#local-6989586621679165687"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-175"></span><span>
</span><span id="line-176"></span><span id="local-6989586621679165971"><span class="annot"><a href="Interpreter.Result.html#unevalRuntimeValue"><span class="hs-identifier hs-type">unevalRuntimeValue</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Interpreter.Result.html#RuntimeValue%27"><span class="hs-identifier hs-type">RuntimeValue'</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Interpreter.Result.html#RuntimeValue"><span class="hs-identifier hs-type">RuntimeValue</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679165971"><span class="hs-identifier hs-type">s</span></a></span></span><span>
</span><span id="line-177"></span><span id="unevalRuntimeValue"><span class="annot"><span class="annottext">unevalRuntimeValue :: forall s. RuntimeValue' -&gt; RuntimeValue s
</span><a href="Interpreter.Result.html#unevalRuntimeValue"><span class="hs-identifier hs-var hs-var">unevalRuntimeValue</span></a></span></span><span> </span><span id="local-6989586621679165684"><span class="annot"><span class="annottext">RuntimeValue'
</span><a href="#local-6989586621679165684"><span class="hs-identifier hs-var">rv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">RuntimeValue'
</span><a href="#local-6989586621679165684"><span class="hs-identifier hs-var">rv</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-178"></span><span>  </span><span class="annot"><a href="Interpreter.Result.html#ValInt%27"><span class="hs-identifier hs-type">ValInt'</span></a></span><span> </span><span id="local-6989586621679165683"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679165683"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall s. Int -&gt; RuntimeValue s
</span><a href="Interpreter.Result.html#ValInt"><span class="hs-identifier hs-var">ValInt</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679165683"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-179"></span><span>  </span><span class="annot"><a href="Interpreter.Result.html#ValBool%27"><span class="hs-identifier hs-type">ValBool'</span></a></span><span> </span><span id="local-6989586621679165682"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679165682"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall s. Bool -&gt; RuntimeValue s
</span><a href="Interpreter.Result.html#ValBool"><span class="hs-identifier hs-var">ValBool</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679165682"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-180"></span><span>  </span><span class="annot"><a href="Interpreter.Result.html#ValString%27"><span class="hs-identifier hs-type">ValString'</span></a></span><span> </span><span id="local-6989586621679165681"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679165681"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall s. Text -&gt; RuntimeValue s
</span><a href="Interpreter.Result.html#ValString"><span class="hs-identifier hs-var">ValString</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679165681"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-181"></span><span>  </span><span class="annot"><a href="Interpreter.Result.html#ValArray%27"><span class="hs-identifier hs-type">ValArray'</span></a></span><span> </span><span id="local-6989586621679165680"><span class="annot"><span class="annottext">[RuntimeValue']
</span><a href="#local-6989586621679165680"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall s. [RuntimeValue s] -&gt; RuntimeValue s
</span><a href="Interpreter.Result.html#ValArray"><span class="hs-identifier hs-var">ValArray</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall s. RuntimeValue' -&gt; RuntimeValue s
</span><a href="Interpreter.Result.html#unevalRuntimeValue"><span class="hs-identifier hs-var">unevalRuntimeValue</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[RuntimeValue']
</span><a href="#local-6989586621679165680"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-182"></span><span>  </span><span class="annot"><a href="Interpreter.Result.html#ValFunction%27"><span class="hs-identifier hs-type">ValFunction'</span></a></span><span> </span><span id="local-6989586621679165679"><span class="annot"><span class="annottext">FunctionValue
</span><a href="#local-6989586621679165679"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall s. FunctionValue -&gt; Scope s -&gt; RuntimeValue s
</span><a href="Interpreter.Result.html#ValFunction"><span class="hs-identifier hs-var">ValFunction</span></a></span><span> </span><span class="annot"><span class="annottext">FunctionValue
</span><a href="#local-6989586621679165679"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">forall s. Scope s
</span><a href="Interpreter.Result.html#emptyScope"><span class="hs-identifier hs-var">emptyScope</span></a></span><span>
</span><span id="line-183"></span><span>
</span><span id="line-184"></span><span class="hs-comment">-- *** Optics</span><span>
</span><span id="line-185"></span><span>
</span><span id="line-186"></span><span id="funcs%27"><span id="funcScopes%27"><span id="accumulatedOutput%27"><span class="hs-identifier">makeLenses</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">Env'</span></span></span></span><span>
</span><span id="line-187"></span><span id="scopes%27"><span class="hs-identifier">makeLenses</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">FuncScope'</span></span><span>
</span><span id="line-188"></span><span id="vars%27"><span class="hs-identifier">makeLenses</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">Scope'</span></span><span>
</span><span id="line-189"></span></pre></body></html>