<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE LambdaCase #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE OverloadedStrings #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE TupleSections #-}</span><span>
</span><span id="line-4"></span><span>
</span><span id="line-5"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Interpreter.Interpreter</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-6"></span><span>
</span><span id="line-7"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Analyzer.AnalyzedAst.html"><span class="hs-identifier">Analyzer.AnalyzedAst</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Ast</span></span><span>
</span><span id="line-8"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Lens</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Ixed</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">ix</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-operator">(%~)</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-operator">(&amp;)</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-operator">(.~)</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-operator">(^.)</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-operator">(^?!)</span></span><span class="hs-special">)</span><span>
</span><span id="line-9"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">foldM</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">void</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-operator">(&gt;=&gt;)</span></span><span class="hs-special">)</span><span>
</span><span id="line-10"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Except</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">MonadError</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">throwError</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">liftEither</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">runExceptT</span></span><span class="hs-special">)</span><span>
</span><span id="line-11"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Extra</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">fromMaybeM</span></span><span class="hs-special">)</span><span>
</span><span id="line-12"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.ST</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">runST</span></span><span class="hs-special">)</span><span>
</span><span id="line-13"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.State</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">MonadState</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">get</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">StateT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">runStateT</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">modify</span></span><span class="hs-special">)</span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Either.Combinators</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">leftToMaybe</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">mapBoth</span></span><span class="hs-special">)</span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Functor</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-operator">($&gt;)</span></span><span class="hs-special">)</span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.List.Extra</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-operator">(!?)</span></span><span class="hs-special">)</span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.STRef</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">newSTRef</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">readSTRef</span></span><span class="hs-special">)</span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Text</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">pack</span></span><span class="hs-special">)</span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">T</span></span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Interpreter.Result.html"><span class="hs-identifier">Interpreter.Result</span></a></span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Interpreter.Runtime.html"><span class="hs-identifier">Interpreter.Runtime</span></a></span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="MaybeVoid.html"><span class="hs-identifier">MaybeVoid</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="MaybeVoid.html#MaybeVoid"><span class="hs-identifier">MaybeVoid</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="MaybeVoid.html#maybeVoid"><span class="hs-identifier">maybeVoid</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="PrimitiveValue.html"><span class="hs-identifier">PrimitiveValue</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">PV</span></span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="StdLib.html"><span class="hs-identifier">StdLib</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="StdLib.html#stdLibFunctionsMap"><span class="hs-identifier">stdLibFunctionsMap</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-26"></span><span>
</span><span id="line-27"></span><span class="hs-comment">------------------------------------------------------Interpreter-------------------------------------------------------</span><span>
</span><span id="line-28"></span><span>
</span><span id="line-29"></span><span class="hs-comment">-- * Interpreter</span><span>
</span><span id="line-30"></span><span>
</span><span id="line-31"></span><span class="hs-comment">-- | Interpreter entry point. Assumes that program is analyzed successfully.</span><span>
</span><span id="line-32"></span><span class="annot"><a href="Interpreter.Interpreter.html#interpret"><span class="hs-identifier hs-type">interpret</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Analyzer.AnalyzedAst.html#Program"><span class="hs-identifier hs-type">Ast.Program</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Interpreter.Result.html#ResultValue"><span class="hs-identifier hs-type">ResultValue</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Interpreter.Result.html#Env%27"><span class="hs-identifier hs-type">Env'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-33"></span><span id="interpret"><span class="annot"><span class="annottext">interpret :: Program -&gt; (ResultValue (), Env')
</span><a href="Interpreter.Interpreter.html#interpret"><span class="hs-identifier hs-var hs-var">interpret</span></a></span></span><span> </span><span id="local-6989586621679168856"><span class="annot"><span class="annottext">Program
</span><a href="#local-6989586621679168856"><span class="hs-identifier hs-var">ast</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. (forall s. ST s a) -&gt; a
</span><span class="hs-identifier hs-var">runST</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-34"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679168849"><span class="annot"><span class="annottext">ResultValue ()
</span><a href="#local-6989586621679168849"><span class="hs-identifier hs-var">res</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679168848"><span class="annot"><span class="annottext">Env s
</span><a href="#local-6989586621679168848"><span class="hs-identifier hs-var">env</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall s (m :: * -&gt; *) a. StateT s m a -&gt; s -&gt; m (a, s)
</span><span class="hs-identifier hs-var">runStateT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall e (m :: * -&gt; *) a. ExceptT e m a -&gt; m (Either e a)
</span><span class="hs-identifier hs-var">runExceptT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall s. Program -&gt; Result s ()
</span><a href="Interpreter.Interpreter.html#interpretProgram"><span class="hs-identifier hs-var">interpretProgram</span></a></span><span> </span><span class="annot"><span class="annottext">Program
</span><a href="#local-6989586621679168856"><span class="hs-identifier hs-var">ast</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall s. Env s
</span><a href="Interpreter.Result.html#emptyEnv"><span class="hs-identifier hs-var">emptyEnv</span></a></span><span>
</span><span id="line-35"></span><span>  </span><span id="local-6989586621679168845"><span class="annot"><span class="annottext">Env'
</span><a href="#local-6989586621679168845"><span class="hs-identifier hs-var">env'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall s. Env s -&gt; ST s Env'
</span><a href="Interpreter.Result.html#evalEnv"><span class="hs-identifier hs-var">evalEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Env s
</span><a href="#local-6989586621679168848"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">forall s. Lens' (Env s) [Text]
</span><a href="Interpreter.Result.html#accumulatedOutput"><span class="hs-identifier hs-var">accumulatedOutput</span></a></span><span> </span><span class="annot"><span class="annottext">forall s t a b. ASetter s t a b -&gt; (a -&gt; b) -&gt; s -&gt; t
</span><span class="hs-operator hs-var">%~</span></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a]
</span><span class="hs-identifier hs-var">reverse</span></span><span class="hs-special">)</span><span>
</span><span id="line-36"></span><span>  </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ResultValue ()
</span><a href="#local-6989586621679168849"><span class="hs-identifier hs-var">res</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Env'
</span><a href="#local-6989586621679168845"><span class="hs-identifier hs-var">env'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-37"></span><span>
</span><span id="line-38"></span><span class="annot"><a href="Interpreter.Interpreter.html#getInterpretationOut"><span class="hs-identifier hs-type">getInterpretationOut</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Interpreter.Result.html#ResultValue"><span class="hs-identifier hs-type">ResultValue</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Interpreter.Result.html#Env%27"><span class="hs-identifier hs-type">Env'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span class="hs-special">)</span><span>
</span><span id="line-39"></span><span id="getInterpretationOut"><span class="annot"><span class="annottext">getInterpretationOut :: (ResultValue (), Env') -&gt; (Text, Maybe Text)
</span><a href="Interpreter.Interpreter.html#getInterpretationOut"><span class="hs-identifier hs-var hs-var">getInterpretationOut</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679168840"><span class="annot"><span class="annottext">ResultValue ()
</span><a href="#local-6989586621679168840"><span class="hs-identifier hs-var">result</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679168839"><span class="annot"><span class="annottext">Env'
</span><a href="#local-6989586621679168839"><span class="hs-identifier hs-var">env</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Text] -&gt; Text
</span><span class="hs-identifier hs-var">T.concat</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Env'
</span><a href="#local-6989586621679168839"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">Lens' Env' [Text]
</span><a href="Interpreter.Result.html#accumulatedOutput%27"><span class="hs-identifier hs-var">accumulatedOutput'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; Text
</span><span class="hs-identifier hs-var">pack</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall a b. Either a b -&gt; Maybe a
</span><span class="hs-identifier hs-var">leftToMaybe</span></span><span> </span><span class="annot"><span class="annottext">ResultValue ()
</span><a href="#local-6989586621679168840"><span class="hs-identifier hs-var">result</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-40"></span><span>
</span><span id="line-41"></span><span class="hs-comment">-------------------------------------------------Program and functions--------------------------------------------------</span><span>
</span><span id="line-42"></span><span>
</span><span id="line-43"></span><span id="local-6989586621679169150"><span class="annot"><a href="Interpreter.Interpreter.html#interpretProgram"><span class="hs-identifier hs-type">interpretProgram</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Analyzer.AnalyzedAst.html#Program"><span class="hs-identifier hs-type">Ast.Program</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Interpreter.Result.html#Result"><span class="hs-identifier hs-type">Result</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679169150"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-44"></span><span id="interpretProgram"><span class="annot"><span class="annottext">interpretProgram :: forall s. Program -&gt; Result s ()
</span><a href="Interpreter.Interpreter.html#interpretProgram"><span class="hs-identifier hs-var hs-var">interpretProgram</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Analyzer.AnalyzedAst.html#Program"><span class="hs-identifier hs-type">Ast.Program</span></a></span><span> </span><span id="local-6989586621679168814"><span class="annot"><span class="annottext">[VarDecl]
</span><a href="#local-6989586621679168814"><span class="hs-identifier hs-var">tlVarDecls</span></a></span></span><span> </span><span id="local-6989586621679168813"><span class="annot"><span class="annottext">[FunctionDef]
</span><a href="#local-6989586621679168813"><span class="hs-identifier hs-var">tlFuncDefs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-45"></span><span>  </span><span id="local-6989586621679168812"><span class="annot"><span class="annottext">Map Text (STRef s Function, Scope s)
</span><a href="#local-6989586621679168812"><span class="hs-identifier hs-var">fs'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall {s}.
ExceptT
  Err (StateT (Env s) (ST s)) (Map Text (STRef s Function, Scope s))
</span><a href="#local-6989586621679168811"><span class="hs-identifier hs-var">fs</span></a></span><span>
</span><span id="line-46"></span><span>  </span><span class="annot"><span class="annottext">forall s (m :: * -&gt; *). MonadState s m =&gt; (s -&gt; s) -&gt; m ()
</span><span class="hs-identifier hs-var">modify</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall s. Lens' (Env s) (Map Text (STRef s Function, Scope s))
</span><a href="Interpreter.Result.html#funcs"><span class="hs-identifier hs-var">funcs</span></a></span><span> </span><span class="annot"><span class="annottext">forall s t a b. ASetter s t a b -&gt; b -&gt; s -&gt; t
</span><span class="hs-operator hs-var">.~</span></span><span> </span><span class="annot"><span class="annottext">Map Text (STRef s Function, Scope s)
</span><a href="#local-6989586621679168812"><span class="hs-identifier hs-var">fs'</span></a></span><span>
</span><span id="line-47"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679168805"><span class="annot"><span class="annottext">STRef s Function
</span><a href="#local-6989586621679168805"><span class="hs-identifier hs-var">main</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679168804"><span class="annot"><span class="annottext">Scope s
</span><a href="#local-6989586621679168804"><span class="hs-identifier hs-var">mainFs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map Text (STRef s Function, Scope s)
</span><a href="#local-6989586621679168812"><span class="hs-identifier hs-var">fs'</span></a></span><span> </span><span class="annot"><span class="annottext">forall k a. Ord k =&gt; Map k a -&gt; k -&gt; a
</span><span class="hs-operator hs-var">Map.!</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;main&quot;</span></span><span>
</span><span id="line-48"></span><span>  </span><span id="local-6989586621679168802"><span class="annot"><span class="annottext">Function
</span><a href="#local-6989586621679168802"><span class="hs-identifier hs-var">main'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall s a. ST s a -&gt; Result s a
</span><a href="Interpreter.Result.html#lift2"><span class="hs-identifier hs-var">lift2</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall s a. STRef s a -&gt; ST s a
</span><span class="hs-identifier hs-var">readSTRef</span></span><span> </span><span class="annot"><span class="annottext">STRef s Function
</span><a href="#local-6989586621679168805"><span class="hs-identifier hs-var">main</span></a></span><span>
</span><span id="line-49"></span><span>  </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><span class="hs-identifier hs-var">void</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall s.
Function
-&gt; Scope s
-&gt; [RuntimeValue s]
-&gt; Result s (MaybeVoid (RuntimeValue s))
</span><a href="Interpreter.Interpreter.html#interpretFunc"><span class="hs-identifier hs-var">interpretFunc</span></a></span><span> </span><span class="annot"><span class="annottext">Function
</span><a href="#local-6989586621679168802"><span class="hs-identifier hs-var">main'</span></a></span><span> </span><span class="annot"><span class="annottext">Scope s
</span><a href="#local-6989586621679168804"><span class="hs-identifier hs-var">mainFs</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-50"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-51"></span><span>    </span><span id="local-6989586621679168787"><span class="annot"><span class="annottext">globalScope :: ExceptT Err (StateT (Env s) (ST s)) (Scope s)
</span><a href="#local-6989586621679168787"><span class="hs-identifier hs-var hs-var">globalScope</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-52"></span><span>      </span><span id="local-6989586621679168786"><span class="annot"><span class="annottext">[STRef s (RuntimeValue s)]
</span><a href="#local-6989586621679168786"><span class="hs-identifier hs-var">vsRefs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall s. Expression -&gt; Result s (RuntimeValue s)
</span><a href="Interpreter.Interpreter.html#interpretExpr%27"><span class="hs-identifier hs-var">interpretExpr'</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b c.
Monad m =&gt;
(a -&gt; m b) -&gt; (b -&gt; m c) -&gt; a -&gt; m c
</span><span class="hs-operator hs-var">&gt;=&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall s a. ST s a -&gt; Result s a
</span><a href="Interpreter.Result.html#lift2"><span class="hs-identifier hs-var">lift2</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a s. a -&gt; ST s (STRef s a)
</span><span class="hs-identifier hs-var">newSTRef</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VarDecl -&gt; Expression
</span><a href="Analyzer.AnalyzedAst.html#%24sel%3AvarValue%3AVarDecl"><span class="hs-identifier hs-var">Ast.varValue</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[VarDecl]
</span><a href="#local-6989586621679168814"><span class="hs-identifier hs-var">tlVarDecls</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-53"></span><span>      </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall s. Map Text (STRef s (RuntimeValue s)) -&gt; Scope s
</span><a href="Interpreter.Result.html#Scope"><span class="hs-identifier hs-var">Scope</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.fromList</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VarDecl -&gt; Text
</span><a href="Analyzer.AnalyzedAst.html#%24sel%3AvarName%3AVarDecl"><span class="hs-identifier hs-var">Ast.varName</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[VarDecl]
</span><a href="#local-6989586621679168814"><span class="hs-identifier hs-var">tlVarDecls</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><span class="hs-operator hs-var">`zip`</span></span><span> </span><span class="annot"><span class="annottext">[STRef s (RuntimeValue s)]
</span><a href="#local-6989586621679168786"><span class="hs-identifier hs-var">vsRefs</span></a></span><span>
</span><span id="line-54"></span><span>
</span><span id="line-55"></span><span>    </span><span id="local-6989586621679168811"><span class="annot"><span class="annottext">fs :: ExceptT
  Err (StateT (Env s) (ST s)) (Map Text (STRef s Function, Scope s))
</span><a href="#local-6989586621679168811"><span class="hs-identifier hs-var hs-var">fs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-56"></span><span>      </span><span id="local-6989586621679168768"><span class="annot"><span class="annottext">Scope s
</span><a href="#local-6989586621679168768"><span class="hs-identifier hs-var">globalScope'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall {s}. ExceptT Err (StateT (Env s) (ST s)) (Scope s)
</span><a href="#local-6989586621679168787"><span class="hs-identifier hs-var">globalScope</span></a></span><span>
</span><span id="line-57"></span><span>      </span><span id="local-6989586621679168767"><span class="annot"><span class="annottext">[STRef s Function]
</span><a href="#local-6989586621679168767"><span class="hs-identifier hs-var">fsRefs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall s a. ST s a -&gt; Result s a
</span><a href="Interpreter.Result.html#lift2"><span class="hs-identifier hs-var">lift2</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">forall a s. a -&gt; ST s (STRef s a)
</span><span class="hs-identifier hs-var">newSTRef</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunctionDef -&gt; Function
</span><a href="Analyzer.AnalyzedAst.html#%24sel%3Afunc%3AFunctionDef"><span class="hs-identifier hs-var">Ast.func</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[FunctionDef]
</span><a href="#local-6989586621679168813"><span class="hs-identifier hs-var">tlFuncDefs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-58"></span><span>      </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.fromList</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunctionDef -&gt; Text
</span><a href="Analyzer.AnalyzedAst.html#%24sel%3AfuncName%3AFunctionDef"><span class="hs-identifier hs-var">Ast.funcName</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[FunctionDef]
</span><a href="#local-6989586621679168813"><span class="hs-identifier hs-var">tlFuncDefs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><span class="hs-operator hs-var">`zip`</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">,</span><span class="annot"><span class="annottext">Scope s
</span><a href="#local-6989586621679168768"><span class="hs-identifier hs-var">globalScope'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[STRef s Function]
</span><a href="#local-6989586621679168767"><span class="hs-identifier hs-var">fsRefs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-59"></span><span>
</span><span id="line-60"></span><span id="local-6989586621679169084"><span class="annot"><a href="Interpreter.Interpreter.html#interpretFunc"><span class="hs-identifier hs-type">interpretFunc</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Analyzer.AnalyzedAst.html#Function"><span class="hs-identifier hs-type">Ast.Function</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Interpreter.Result.html#Scope"><span class="hs-identifier hs-type">Scope</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679169084"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Interpreter.Result.html#RuntimeValue"><span class="hs-identifier hs-type">RuntimeValue</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679169084"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Interpreter.Result.html#Result"><span class="hs-identifier hs-type">Result</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679169084"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="MaybeVoid.html#MaybeVoid"><span class="hs-identifier hs-type">MaybeVoid</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Interpreter.Result.html#RuntimeValue"><span class="hs-identifier hs-type">RuntimeValue</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679169084"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span><span>
</span><span id="line-61"></span><span id="interpretFunc"><span class="annot"><span class="annottext">interpretFunc :: forall s.
Function
-&gt; Scope s
-&gt; [RuntimeValue s]
-&gt; Result s (MaybeVoid (RuntimeValue s))
</span><a href="Interpreter.Interpreter.html#interpretFunc"><span class="hs-identifier hs-var hs-var">interpretFunc</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Analyzer.AnalyzedAst.html#FuncOrdinary"><span class="hs-identifier hs-type">Ast.FuncOrdinary</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Analyzer.AnalyzedAst.html#OrdinaryFunction"><span class="hs-identifier hs-type">Ast.OrdinaryFunction</span></a></span><span> </span><span id="local-6989586621679168739"><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679168739"><span class="hs-identifier hs-var">params</span></a></span></span><span> </span><span id="local-6989586621679168738"><span class="annot"><span class="annottext">Block
</span><a href="#local-6989586621679168738"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span id="local-6989586621679168737"><span class="annot"><span class="annottext">VoidMark
</span><a href="#local-6989586621679168737"><span class="hs-identifier hs-var">voidMark</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Interpreter.Result.html#Scope"><span class="hs-identifier hs-type">Scope</span></a></span><span> </span><span id="local-6989586621679168736"><span class="annot"><span class="annottext">Map Text (STRef s (RuntimeValue s))
</span><a href="#local-6989586621679168736"><span class="hs-identifier hs-var">ns</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679168735"><span class="annot"><span class="annottext">[RuntimeValue s]
</span><a href="#local-6989586621679168735"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-62"></span><span>  </span><span id="local-6989586621679168734"><span class="annot"><span class="annottext">Map Text (STRef s (RuntimeValue s))
</span><a href="#local-6989586621679168734"><span class="hs-identifier hs-var">args'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall s a. ST s a -&gt; Result s a
</span><a href="Interpreter.Result.html#lift2"><span class="hs-identifier hs-var">lift2</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">forall a s. a -&gt; ST s (STRef s a)
</span><span class="hs-identifier hs-var">newSTRef</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.fromList</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679168739"><span class="hs-identifier hs-var">params</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><span class="hs-operator hs-var">`zip`</span></span><span> </span><span class="annot"><span class="annottext">[RuntimeValue s]
</span><a href="#local-6989586621679168735"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-63"></span><span>  </span><span id="local-6989586621679168733"><span class="annot"><span class="annottext">StmtResult s
</span><a href="#local-6989586621679168733"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall s. FuncScope s -&gt; Block -&gt; Result s (StmtResult s)
</span><a href="Interpreter.Interpreter.html#interpretFuncBlock"><span class="hs-identifier hs-var">interpretFuncBlock</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall s. [Scope s] -&gt; FuncScope s
</span><a href="Interpreter.Result.html#FuncScope"><span class="hs-identifier hs-var">FuncScope</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">forall s. Map Text (STRef s (RuntimeValue s)) -&gt; Scope s
</span><a href="Interpreter.Result.html#Scope"><span class="hs-identifier hs-var">Scope</span></a></span><span> </span><span class="annot"><span class="annottext">Map Text (STRef s (RuntimeValue s))
</span><a href="#local-6989586621679168734"><span class="hs-identifier hs-var">args'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall s. Map Text (STRef s (RuntimeValue s)) -&gt; Scope s
</span><a href="Interpreter.Result.html#Scope"><span class="hs-identifier hs-var">Scope</span></a></span><span> </span><span class="annot"><span class="annottext">Map Text (STRef s (RuntimeValue s))
</span><a href="#local-6989586621679168736"><span class="hs-identifier hs-var">ns</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Block
</span><a href="#local-6989586621679168738"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-64"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StmtResult s
</span><a href="#local-6989586621679168733"><span class="hs-identifier hs-var">res</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">VoidMark
</span><a href="#local-6989586621679168737"><span class="hs-identifier hs-var">voidMark</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-65"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Interpreter.Interpreter.html#Ret"><span class="hs-identifier hs-type">Ret</span></a></span><span> </span><span id="local-6989586621679168729"><span class="annot"><span class="annottext">MaybeVoid (RuntimeValue s)
</span><a href="#local-6989586621679168729"><span class="hs-identifier hs-var">val</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">VoidMark
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">MaybeVoid (RuntimeValue s)
</span><a href="#local-6989586621679168729"><span class="hs-identifier hs-var">val</span></a></span><span>
</span><span id="line-66"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StmtResult s
</span><a href="Interpreter.Interpreter.html#Unit"><span class="hs-identifier hs-var">Unit</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">VoidMark
</span><a href="Analyzer.AnalyzedAst.html#VoidFunc"><span class="hs-identifier hs-var">Ast.VoidFunc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">forall a. MaybeVoid a
</span><a href="MaybeVoid.html#Void"><span class="hs-identifier hs-var">Void</span></a></span><span>
</span><span id="line-67"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StmtResult s
</span><a href="Interpreter.Interpreter.html#Unit"><span class="hs-identifier hs-var">Unit</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">VoidMark
</span><a href="Analyzer.AnalyzedAst.html#NonVoidFunc"><span class="hs-identifier hs-var">Ast.NonVoidFunc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">Err
</span><a href="Interpreter.Result.html#NoReturn"><span class="hs-identifier hs-var">NoReturn</span></a></span><span>
</span><span id="line-68"></span><span>    </span><span class="annot"><span class="annottext">(StmtResult s, VoidMark)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">Err
</span><a href="Interpreter.Result.html#UnexpectedError"><span class="hs-identifier hs-var">UnexpectedError</span></a></span><span>
</span><span id="line-69"></span><span class="annot"><a href="Interpreter.Interpreter.html#interpretFunc"><span class="hs-identifier hs-var">interpretFunc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Analyzer.AnalyzedAst.html#FuncStdLib"><span class="hs-identifier hs-type">Ast.FuncStdLib</span></a></span><span> </span><span id="local-6989586621679168721"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679168721"><span class="hs-identifier hs-var">name</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Scope s
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679168720"><span class="annot"><span class="annottext">[RuntimeValue s]
</span><a href="#local-6989586621679168720"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-70"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679168718"><span class="annot"><span class="annottext">func :: StdLibFuncImpl
</span><a href="#local-6989586621679168718"><span class="hs-identifier hs-var hs-var">func</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map Text StdLibFuncImpl
</span><a href="StdLib.html#stdLibFunctionsMap"><span class="hs-identifier hs-var">stdLibFunctionsMap</span></a></span><span> </span><span class="annot"><span class="annottext">forall k a. Ord k =&gt; Map k a -&gt; k -&gt; a
</span><span class="hs-operator hs-var">Map.!</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679168721"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-71"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679168717"><span class="annot"><span class="annottext">MaybeVoid RuntimeValue'
</span><a href="#local-6989586621679168717"><span class="hs-identifier hs-var">res</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679168716"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679168716"><span class="hs-identifier hs-var">out</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall e (m :: * -&gt; *) a. MonadError e m =&gt; Either e a -&gt; m a
</span><span class="hs-identifier hs-var">liftEither</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">StdLibFuncImpl
</span><a href="#local-6989586621679168718"><span class="hs-identifier hs-var">func</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall s. RuntimeValue s -&gt; RuntimeValue'
</span><a href="Interpreter.Result.html#evalRuntimeValue"><span class="hs-identifier hs-var">evalRuntimeValue</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[RuntimeValue s]
</span><a href="#local-6989586621679168720"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-72"></span><span>  </span><span class="annot"><span class="annottext">forall s (m :: * -&gt; *). MonadState s m =&gt; (s -&gt; s) -&gt; m ()
</span><span class="hs-identifier hs-var">modify</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall s. Lens' (Env s) [Text]
</span><a href="Interpreter.Result.html#accumulatedOutput"><span class="hs-identifier hs-var">accumulatedOutput</span></a></span><span> </span><span class="annot"><span class="annottext">forall s t a b. ASetter s t a b -&gt; (a -&gt; b) -&gt; s -&gt; t
</span><span class="hs-operator hs-var">%~</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679168716"><span class="hs-identifier hs-var">out</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="hs-special">)</span><span>
</span><span id="line-73"></span><span>  </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall s. RuntimeValue' -&gt; RuntimeValue s
</span><a href="Interpreter.Result.html#unevalRuntimeValue"><span class="hs-identifier hs-var">unevalRuntimeValue</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">MaybeVoid RuntimeValue'
</span><a href="#local-6989586621679168717"><span class="hs-identifier hs-var">res</span></a></span><span>
</span><span id="line-74"></span><span>
</span><span id="line-75"></span><span id="local-6989586621679169054"><span class="annot"><a href="Interpreter.Interpreter.html#interpretFuncBlock"><span class="hs-identifier hs-type">interpretFuncBlock</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Interpreter.Result.html#FuncScope"><span class="hs-identifier hs-type">FuncScope</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679169054"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Analyzer.AnalyzedAst.html#Block"><span class="hs-identifier hs-type">Ast.Block</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Interpreter.Result.html#Result"><span class="hs-identifier hs-type">Result</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679169054"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Interpreter.Interpreter.html#StmtResult"><span class="hs-identifier hs-type">StmtResult</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679169054"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-76"></span><span id="interpretFuncBlock"><span class="annot"><span class="annottext">interpretFuncBlock :: forall s. FuncScope s -&gt; Block -&gt; Result s (StmtResult s)
</span><a href="Interpreter.Interpreter.html#interpretFuncBlock"><span class="hs-identifier hs-var hs-var">interpretFuncBlock</span></a></span></span><span> </span><span id="local-6989586621679168713"><span class="annot"><span class="annottext">FuncScope s
</span><a href="#local-6989586621679168713"><span class="hs-identifier hs-var">initScope</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall scope s.
scope
-&gt; (scope -&gt; Env s -&gt; Env s)
-&gt; (Env s -&gt; Env s)
-&gt; Block
-&gt; Result s (StmtResult s)
</span><a href="Interpreter.Interpreter.html#interpretBlock%27"><span class="hs-identifier hs-var">interpretBlock'</span></a></span><span> </span><span class="annot"><span class="annottext">FuncScope s
</span><a href="#local-6989586621679168713"><span class="hs-identifier hs-var">initScope</span></a></span><span> </span><span class="annot"><span class="annottext">forall s. FuncScope s -&gt; Env s -&gt; Env s
</span><a href="Interpreter.Runtime.html#pushFuncScope"><span class="hs-identifier hs-var">pushFuncScope</span></a></span><span> </span><span class="annot"><span class="annottext">forall s. Env s -&gt; Env s
</span><a href="Interpreter.Runtime.html#popFuncScope"><span class="hs-identifier hs-var">popFuncScope</span></a></span><span>
</span><span id="line-77"></span><span>
</span><span id="line-78"></span><span id="local-6989586621679169034"><span class="annot"><a href="Interpreter.Interpreter.html#interpretBlock"><span class="hs-identifier hs-type">interpretBlock</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Interpreter.Result.html#Scope"><span class="hs-identifier hs-type">Scope</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679169034"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Analyzer.AnalyzedAst.html#Block"><span class="hs-identifier hs-type">Ast.Block</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Interpreter.Result.html#Result"><span class="hs-identifier hs-type">Result</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679169034"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Interpreter.Interpreter.html#StmtResult"><span class="hs-identifier hs-type">StmtResult</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679169034"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-79"></span><span id="interpretBlock"><span class="annot"><span class="annottext">interpretBlock :: forall s. Scope s -&gt; Block -&gt; Result s (StmtResult s)
</span><a href="Interpreter.Interpreter.html#interpretBlock"><span class="hs-identifier hs-var hs-var">interpretBlock</span></a></span></span><span> </span><span id="local-6989586621679168708"><span class="annot"><span class="annottext">Scope s
</span><a href="#local-6989586621679168708"><span class="hs-identifier hs-var">initScope</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall scope s.
scope
-&gt; (scope -&gt; Env s -&gt; Env s)
-&gt; (Env s -&gt; Env s)
-&gt; Block
-&gt; Result s (StmtResult s)
</span><a href="Interpreter.Interpreter.html#interpretBlock%27"><span class="hs-identifier hs-var">interpretBlock'</span></a></span><span> </span><span class="annot"><span class="annottext">Scope s
</span><a href="#local-6989586621679168708"><span class="hs-identifier hs-var">initScope</span></a></span><span> </span><span class="annot"><span class="annottext">forall s. Scope s -&gt; Env s -&gt; Env s
</span><a href="Interpreter.Runtime.html#pushBlockScope"><span class="hs-identifier hs-var">pushBlockScope</span></a></span><span> </span><span class="annot"><span class="annottext">forall s. Env s -&gt; Env s
</span><a href="Interpreter.Runtime.html#popBlockScope"><span class="hs-identifier hs-var">popBlockScope</span></a></span><span>
</span><span id="line-80"></span><span>
</span><span id="line-81"></span><span id="local-6989586621679169037"><span id="local-6989586621679169038"><span class="annot"><a href="Interpreter.Interpreter.html#interpretBlock%27"><span class="hs-identifier hs-type">interpretBlock'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679169038"><span class="hs-identifier hs-type">scope</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679169038"><span class="hs-identifier hs-type">scope</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Interpreter.Result.html#Env"><span class="hs-identifier hs-type">Env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679169037"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Interpreter.Result.html#Env"><span class="hs-identifier hs-type">Env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679169037"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Interpreter.Result.html#Env"><span class="hs-identifier hs-type">Env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679169037"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Interpreter.Result.html#Env"><span class="hs-identifier hs-type">Env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679169037"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Analyzer.AnalyzedAst.html#Block"><span class="hs-identifier hs-type">Ast.Block</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Interpreter.Result.html#Result"><span class="hs-identifier hs-type">Result</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679169037"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Interpreter.Interpreter.html#StmtResult"><span class="hs-identifier hs-type">StmtResult</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679169037"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-82"></span><span id="interpretBlock%27"><span class="annot"><span class="annottext">interpretBlock' :: forall scope s.
scope
-&gt; (scope -&gt; Env s -&gt; Env s)
-&gt; (Env s -&gt; Env s)
-&gt; Block
-&gt; Result s (StmtResult s)
</span><a href="Interpreter.Interpreter.html#interpretBlock%27"><span class="hs-identifier hs-var hs-var">interpretBlock'</span></a></span></span><span> </span><span id="local-6989586621679168693"><span class="annot"><span class="annottext">scope
</span><a href="#local-6989586621679168693"><span class="hs-identifier hs-var">initScope</span></a></span></span><span> </span><span id="local-6989586621679168692"><span class="annot"><span class="annottext">scope -&gt; Env s -&gt; Env s
</span><a href="#local-6989586621679168692"><span class="hs-identifier hs-var">pushScope</span></a></span></span><span> </span><span id="local-6989586621679168691"><span class="annot"><span class="annottext">Env s -&gt; Env s
</span><a href="#local-6989586621679168691"><span class="hs-identifier hs-var">popScope</span></a></span></span><span> </span><span id="local-6989586621679168690"><span class="annot"><span class="annottext">Block
</span><a href="#local-6989586621679168690"><span class="hs-identifier hs-var">block</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-83"></span><span>  </span><span class="annot"><span class="annottext">forall s (m :: * -&gt; *). MonadState s m =&gt; (s -&gt; s) -&gt; m ()
</span><span class="hs-identifier hs-var">modify</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">scope -&gt; Env s -&gt; Env s
</span><a href="#local-6989586621679168692"><span class="hs-identifier hs-var">pushScope</span></a></span><span> </span><span class="annot"><span class="annottext">scope
</span><a href="#local-6989586621679168693"><span class="hs-identifier hs-var">initScope</span></a></span><span>
</span><span id="line-84"></span><span>  </span><span id="local-6989586621679168689"><span class="annot"><span class="annottext">StmtResult s
</span><a href="#local-6989586621679168689"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldl</span></span><span> </span><span class="annot"><span class="annottext">forall {s}.
ExceptT Err (StateT (Env s) (ST s)) (StmtResult s)
-&gt; Statement -&gt; ExceptT Err (StateT (Env s) (ST s)) (StmtResult s)
</span><a href="#local-6989586621679168687"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">forall s. StmtResult s
</span><a href="Interpreter.Interpreter.html#Unit"><span class="hs-identifier hs-var">Unit</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Block
</span><a href="#local-6989586621679168690"><span class="hs-identifier hs-var">block</span></a></span><span>
</span><span id="line-85"></span><span>  </span><span class="annot"><span class="annottext">forall s (m :: * -&gt; *). MonadState s m =&gt; (s -&gt; s) -&gt; m ()
</span><span class="hs-identifier hs-var">modify</span></span><span> </span><span class="annot"><span class="annottext">Env s -&gt; Env s
</span><a href="#local-6989586621679168691"><span class="hs-identifier hs-var">popScope</span></a></span><span>
</span><span id="line-86"></span><span>  </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">StmtResult s
</span><a href="#local-6989586621679168689"><span class="hs-identifier hs-var">res</span></a></span><span>
</span><span id="line-87"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-88"></span><span>    </span><span id="local-6989586621679168687"><span class="annot"><span class="annottext">f :: ExceptT Err (StateT (Env s) (ST s)) (StmtResult s)
-&gt; Statement -&gt; ExceptT Err (StateT (Env s) (ST s)) (StmtResult s)
</span><a href="#local-6989586621679168687"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679168681"><span class="annot"><span class="annottext">ExceptT Err (StateT (Env s) (ST s)) (StmtResult s)
</span><a href="#local-6989586621679168681"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span id="local-6989586621679168680"><span class="annot"><span class="annottext">Statement
</span><a href="#local-6989586621679168680"><span class="hs-identifier hs-var">stmt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ExceptT Err (StateT (Env s) (ST s)) (StmtResult s)
</span><a href="#local-6989586621679168681"><span class="hs-identifier hs-var">res</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679168679"><span class="annot"><span class="annottext">StmtResult s
</span><a href="#local-6989586621679168679"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">StmtResult s
</span><a href="#local-6989586621679168679"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">forall s. StmtResult s
</span><a href="Interpreter.Interpreter.html#Unit"><span class="hs-identifier hs-var">Unit</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">forall s. Statement -&gt; Result s (StmtResult s)
</span><a href="Interpreter.Interpreter.html#interpretStmt"><span class="hs-identifier hs-var">interpretStmt</span></a></span><span> </span><span class="annot"><span class="annottext">Statement
</span><a href="#local-6989586621679168680"><span class="hs-identifier hs-var">stmt</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">StmtResult s
</span><a href="#local-6989586621679168679"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-89"></span><span>
</span><span id="line-90"></span><span class="hs-comment">-------------------------------------------------------Statements-------------------------------------------------------</span><span>
</span><span id="line-91"></span><span>
</span><span id="line-92"></span><span id="local-6989586621679169020"><span class="annot"><a href="Interpreter.Interpreter.html#interpretStmt"><span class="hs-identifier hs-type">interpretStmt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Analyzer.AnalyzedAst.html#Statement"><span class="hs-identifier hs-type">Ast.Statement</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Interpreter.Result.html#Result"><span class="hs-identifier hs-type">Result</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679169020"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Interpreter.Interpreter.html#StmtResult"><span class="hs-identifier hs-type">StmtResult</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679169020"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-93"></span><span id="interpretStmt"><span class="annot"><span class="annottext">interpretStmt :: forall s. Statement -&gt; Result s (StmtResult s)
</span><a href="Interpreter.Interpreter.html#interpretStmt"><span class="hs-identifier hs-var hs-var">interpretStmt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-94"></span><span>  </span><span class="annot"><a href="Analyzer.AnalyzedAst.html#StmtReturn"><span class="hs-identifier hs-type">Ast.StmtReturn</span></a></span><span> </span><span id="local-6989586621679168676"><span class="annot"><span class="annottext">MaybeVoid Expression
</span><a href="#local-6989586621679168676"><span class="hs-identifier hs-var">expr</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall s. MaybeVoid Expression -&gt; Result s (StmtResult s)
</span><a href="Interpreter.Interpreter.html#interpretStmtReturn"><span class="hs-identifier hs-var">interpretStmtReturn</span></a></span><span> </span><span class="annot"><span class="annottext">MaybeVoid Expression
</span><a href="#local-6989586621679168676"><span class="hs-identifier hs-var">expr</span></a></span><span>
</span><span id="line-95"></span><span>  </span><span class="annot"><a href="Analyzer.AnalyzedAst.html#StmtForGoTo"><span class="hs-identifier hs-type">Ast.StmtForGoTo</span></a></span><span> </span><span id="local-6989586621679168673"><span class="annot"><span class="annottext">ForGoTo
</span><a href="#local-6989586621679168673"><span class="hs-identifier hs-var">goto</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall s. ForGoTo -&gt; Result s (StmtResult s)
</span><a href="Interpreter.Interpreter.html#interpretStmtForGoTo"><span class="hs-identifier hs-var">interpretStmtForGoTo</span></a></span><span> </span><span class="annot"><span class="annottext">ForGoTo
</span><a href="#local-6989586621679168673"><span class="hs-identifier hs-var">goto</span></a></span><span>
</span><span id="line-96"></span><span>  </span><span class="annot"><a href="Analyzer.AnalyzedAst.html#StmtFor"><span class="hs-identifier hs-type">Ast.StmtFor</span></a></span><span> </span><span id="local-6989586621679168670"><span class="annot"><span class="annottext">For
</span><a href="#local-6989586621679168670"><span class="hs-identifier hs-var">for</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall s. For -&gt; Result s (StmtResult s)
</span><a href="Interpreter.Interpreter.html#interpretStmtFor"><span class="hs-identifier hs-var">interpretStmtFor</span></a></span><span> </span><span class="annot"><span class="annottext">For
</span><a href="#local-6989586621679168670"><span class="hs-identifier hs-var">for</span></a></span><span>
</span><span id="line-97"></span><span>  </span><span class="annot"><a href="Analyzer.AnalyzedAst.html#StmtVarDecl"><span class="hs-identifier hs-type">Ast.StmtVarDecl</span></a></span><span> </span><span id="local-6989586621679168667"><span class="annot"><span class="annottext">VarDecl
</span><a href="#local-6989586621679168667"><span class="hs-identifier hs-var">varDecl</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall s. VarDecl -&gt; Result s (StmtResult s)
</span><a href="Interpreter.Interpreter.html#interpretStmtVarDecl"><span class="hs-identifier hs-var">interpretStmtVarDecl</span></a></span><span> </span><span class="annot"><span class="annottext">VarDecl
</span><a href="#local-6989586621679168667"><span class="hs-identifier hs-var">varDecl</span></a></span><span>
</span><span id="line-98"></span><span>  </span><span class="annot"><a href="Analyzer.AnalyzedAst.html#StmtIfElse"><span class="hs-identifier hs-type">Ast.StmtIfElse</span></a></span><span> </span><span id="local-6989586621679168664"><span class="annot"><span class="annottext">IfElse
</span><a href="#local-6989586621679168664"><span class="hs-identifier hs-var">ifElse</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall s. IfElse -&gt; Result s (StmtResult s)
</span><a href="Interpreter.Interpreter.html#interpretStmtIfElse"><span class="hs-identifier hs-var">interpretStmtIfElse</span></a></span><span> </span><span class="annot"><span class="annottext">IfElse
</span><a href="#local-6989586621679168664"><span class="hs-identifier hs-var">ifElse</span></a></span><span>
</span><span id="line-99"></span><span>  </span><span class="annot"><a href="Analyzer.AnalyzedAst.html#StmtBlock"><span class="hs-identifier hs-type">Ast.StmtBlock</span></a></span><span> </span><span id="local-6989586621679168661"><span class="annot"><span class="annottext">Block
</span><a href="#local-6989586621679168661"><span class="hs-identifier hs-var">block</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall s. Scope s -&gt; Block -&gt; Result s (StmtResult s)
</span><a href="Interpreter.Interpreter.html#interpretBlock"><span class="hs-identifier hs-var">interpretBlock</span></a></span><span> </span><span class="annot"><span class="annottext">forall s. Scope s
</span><a href="Interpreter.Result.html#emptyScope"><span class="hs-identifier hs-var">emptyScope</span></a></span><span> </span><span class="annot"><span class="annottext">Block
</span><a href="#local-6989586621679168661"><span class="hs-identifier hs-var">block</span></a></span><span>
</span><span id="line-100"></span><span>  </span><span class="annot"><a href="Analyzer.AnalyzedAst.html#StmtSimple"><span class="hs-identifier hs-type">Ast.StmtSimple</span></a></span><span> </span><span id="local-6989586621679168658"><span class="annot"><span class="annottext">SimpleStmt
</span><a href="#local-6989586621679168658"><span class="hs-identifier hs-var">simpleStmt</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall s. SimpleStmt -&gt; Result s (StmtResult s)
</span><a href="Interpreter.Interpreter.html#interpretStmtSimple"><span class="hs-identifier hs-var">interpretStmtSimple</span></a></span><span> </span><span class="annot"><span class="annottext">SimpleStmt
</span><a href="#local-6989586621679168658"><span class="hs-identifier hs-var">simpleStmt</span></a></span><span>
</span><span id="line-101"></span><span>
</span><span id="line-102"></span><span id="local-6989586621679169018"><span class="annot"><a href="Interpreter.Interpreter.html#interpretStmtReturn"><span class="hs-identifier hs-type">interpretStmtReturn</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="MaybeVoid.html#MaybeVoid"><span class="hs-identifier hs-type">MaybeVoid</span></a></span><span> </span><span class="annot"><a href="Analyzer.AnalyzedAst.html#Expression"><span class="hs-identifier hs-type">Ast.Expression</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Interpreter.Result.html#Result"><span class="hs-identifier hs-type">Result</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679169018"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Interpreter.Interpreter.html#StmtResult"><span class="hs-identifier hs-type">StmtResult</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679169018"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-103"></span><span id="interpretStmtReturn"><span class="annot"><span class="annottext">interpretStmtReturn :: forall s. MaybeVoid Expression -&gt; Result s (StmtResult s)
</span><a href="Interpreter.Interpreter.html#interpretStmtReturn"><span class="hs-identifier hs-var hs-var">interpretStmtReturn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall b a. b -&gt; (a -&gt; b) -&gt; MaybeVoid a -&gt; b
</span><a href="MaybeVoid.html#maybeVoid"><span class="hs-identifier hs-var">maybeVoid</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall s. MaybeVoid (RuntimeValue s) -&gt; StmtResult s
</span><a href="Interpreter.Interpreter.html#Ret"><span class="hs-identifier hs-var">Ret</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. MaybeVoid a
</span><a href="MaybeVoid.html#Void"><span class="hs-identifier hs-var">Void</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">forall s. MaybeVoid (RuntimeValue s) -&gt; StmtResult s
</span><a href="Interpreter.Interpreter.html#Ret"><span class="hs-identifier hs-var">Ret</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall s. Expression -&gt; Result s (MaybeVoid (RuntimeValue s))
</span><a href="Interpreter.Interpreter.html#interpretExpr"><span class="hs-identifier hs-var">interpretExpr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-104"></span><span>
</span><span id="line-105"></span><span id="local-6989586621679169016"><span class="annot"><a href="Interpreter.Interpreter.html#interpretStmtForGoTo"><span class="hs-identifier hs-type">interpretStmtForGoTo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Parser.Ast.html#ForGoTo"><span class="hs-identifier hs-type">Ast.ForGoTo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Interpreter.Result.html#Result"><span class="hs-identifier hs-type">Result</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679169016"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Interpreter.Interpreter.html#StmtResult"><span class="hs-identifier hs-type">StmtResult</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679169016"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-106"></span><span id="interpretStmtForGoTo"><span class="annot"><span class="annottext">interpretStmtForGoTo :: forall s. ForGoTo -&gt; Result s (StmtResult s)
</span><a href="Interpreter.Interpreter.html#interpretStmtForGoTo"><span class="hs-identifier hs-var hs-var">interpretStmtForGoTo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-107"></span><span>  </span><span class="annot"><span class="annottext">ForGoTo
</span><a href="Parser.Ast.html#Break"><span class="hs-identifier hs-var">Ast.Break</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">forall s. StmtResult s
</span><a href="Interpreter.Interpreter.html#Break"><span class="hs-identifier hs-var">Break</span></a></span><span>
</span><span id="line-108"></span><span>  </span><span class="annot"><span class="annottext">ForGoTo
</span><a href="Parser.Ast.html#Continue"><span class="hs-identifier hs-var">Ast.Continue</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">forall s. StmtResult s
</span><a href="Interpreter.Interpreter.html#Continue"><span class="hs-identifier hs-var">Continue</span></a></span><span>
</span><span id="line-109"></span><span>
</span><span id="line-110"></span><span id="local-6989586621679169014"><span class="annot"><a href="Interpreter.Interpreter.html#interpretStmtFor"><span class="hs-identifier hs-type">interpretStmtFor</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Analyzer.AnalyzedAst.html#For"><span class="hs-identifier hs-type">Ast.For</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Interpreter.Result.html#Result"><span class="hs-identifier hs-type">Result</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679169014"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Interpreter.Interpreter.html#StmtResult"><span class="hs-identifier hs-type">StmtResult</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679169014"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-111"></span><span id="interpretStmtFor"><span class="annot"><span class="annottext">interpretStmtFor :: forall s. For -&gt; Result s (StmtResult s)
</span><a href="Interpreter.Interpreter.html#interpretStmtFor"><span class="hs-identifier hs-var hs-var">interpretStmtFor</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Analyzer.AnalyzedAst.html#For"><span class="hs-identifier hs-type">Ast.For</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Analyzer.AnalyzedAst.html#ForHead"><span class="hs-identifier hs-type">Ast.ForHead</span></a></span><span> </span><span id="local-6989586621679168625"><span class="annot"><span class="annottext">Maybe SimpleStmt
</span><a href="#local-6989586621679168625"><span class="hs-identifier hs-var">pre</span></a></span></span><span> </span><span id="local-6989586621679168624"><span class="annot"><span class="annottext">Maybe Expression
</span><a href="#local-6989586621679168624"><span class="hs-identifier hs-var">cond</span></a></span></span><span> </span><span id="local-6989586621679168623"><span class="annot"><span class="annottext">Maybe SimpleStmt
</span><a href="#local-6989586621679168623"><span class="hs-identifier hs-var">post</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679168622"><span class="annot"><span class="annottext">Block
</span><a href="#local-6989586621679168622"><span class="hs-identifier hs-var">block</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-112"></span><span>  </span><span class="annot"><span class="annottext">forall s (m :: * -&gt; *). MonadState s m =&gt; (s -&gt; s) -&gt; m ()
</span><span class="hs-identifier hs-var">modify</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall s. Scope s -&gt; Env s -&gt; Env s
</span><a href="Interpreter.Runtime.html#pushBlockScope"><span class="hs-identifier hs-var">pushBlockScope</span></a></span><span> </span><span class="annot"><span class="annottext">forall s. Scope s
</span><a href="Interpreter.Result.html#emptyScope"><span class="hs-identifier hs-var">emptyScope</span></a></span><span>
</span><span id="line-113"></span><span>  </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="annot"><span class="annottext">forall s. SimpleStmt -&gt; Result s (StmtResult s)
</span><a href="Interpreter.Interpreter.html#interpretStmtSimple"><span class="hs-identifier hs-var">interpretStmtSimple</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe SimpleStmt
</span><a href="#local-6989586621679168625"><span class="hs-identifier hs-var">pre</span></a></span><span>
</span><span id="line-114"></span><span>  </span><span id="local-6989586621679168620"><span class="annot"><span class="annottext">StmtResult s
</span><a href="#local-6989586621679168620"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall {s}. ExceptT Err (StateT (Env s) (ST s)) (StmtResult s)
</span><a href="#local-6989586621679168619"><span class="hs-identifier hs-var">for</span></a></span><span>
</span><span id="line-115"></span><span>  </span><span class="annot"><span class="annottext">forall s (m :: * -&gt; *). MonadState s m =&gt; (s -&gt; s) -&gt; m ()
</span><span class="hs-identifier hs-var">modify</span></span><span> </span><span class="annot"><span class="annottext">forall s. Env s -&gt; Env s
</span><a href="Interpreter.Runtime.html#popBlockScope"><span class="hs-identifier hs-var">popBlockScope</span></a></span><span>
</span><span id="line-116"></span><span>  </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">StmtResult s
</span><a href="#local-6989586621679168620"><span class="hs-identifier hs-var">res</span></a></span><span>
</span><span id="line-117"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-118"></span><span>    </span><span id="local-6989586621679168619"><span class="annot"><span class="annottext">for :: ExceptT Err (StateT (Env s) (ST s)) (StmtResult s)
</span><a href="#local-6989586621679168619"><span class="hs-identifier hs-var hs-var">for</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-119"></span><span>      </span><span id="local-6989586621679168594"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679168594"><span class="hs-identifier hs-var">cond'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; m (Maybe a) -&gt; m a
</span><span class="hs-identifier hs-var">fromMaybeM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">forall s. Expression -&gt; Result s Bool
</span><a href="Interpreter.Interpreter.html#interpretBoolExpr"><span class="hs-identifier hs-var">interpretBoolExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Expression
</span><a href="#local-6989586621679168624"><span class="hs-identifier hs-var">cond</span></a></span><span>
</span><span id="line-120"></span><span>      </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679168594"><span class="hs-identifier hs-var">cond'</span></a></span><span>
</span><span id="line-121"></span><span>        </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-122"></span><span>          </span><span id="local-6989586621679168592"><span class="annot"><span class="annottext">StmtResult s
</span><a href="#local-6989586621679168592"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall s. Scope s -&gt; Block -&gt; Result s (StmtResult s)
</span><a href="Interpreter.Interpreter.html#interpretBlock"><span class="hs-identifier hs-var">interpretBlock</span></a></span><span> </span><span class="annot"><span class="annottext">forall s. Scope s
</span><a href="Interpreter.Result.html#emptyScope"><span class="hs-identifier hs-var">emptyScope</span></a></span><span> </span><span class="annot"><span class="annottext">Block
</span><a href="#local-6989586621679168622"><span class="hs-identifier hs-var">block</span></a></span><span>
</span><span id="line-123"></span><span>          </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">StmtResult s
</span><a href="#local-6989586621679168592"><span class="hs-identifier hs-var">res</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-124"></span><span>            </span><span class="annot"><span class="annottext">StmtResult s
</span><a href="Interpreter.Interpreter.html#Unit"><span class="hs-identifier hs-var">Unit</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="annot"><span class="annottext">forall s. SimpleStmt -&gt; Result s (StmtResult s)
</span><a href="Interpreter.Interpreter.html#interpretStmtSimple"><span class="hs-identifier hs-var">interpretStmtSimple</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe SimpleStmt
</span><a href="#local-6989586621679168623"><span class="hs-identifier hs-var">post</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">ExceptT Err (StateT (Env s) (ST s)) (StmtResult s)
</span><a href="#local-6989586621679168619"><span class="hs-identifier hs-var">for</span></a></span><span>
</span><span id="line-125"></span><span>            </span><span class="annot"><span class="annottext">StmtResult s
</span><a href="Interpreter.Interpreter.html#Break"><span class="hs-identifier hs-var">Break</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="annot"><span class="annottext">forall s. SimpleStmt -&gt; Result s (StmtResult s)
</span><a href="Interpreter.Interpreter.html#interpretStmtSimple"><span class="hs-identifier hs-var">interpretStmtSimple</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe SimpleStmt
</span><a href="#local-6989586621679168623"><span class="hs-identifier hs-var">post</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; b -&gt; f b
</span><span class="hs-operator hs-var">$&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall s. StmtResult s
</span><a href="Interpreter.Interpreter.html#Unit"><span class="hs-identifier hs-var">Unit</span></a></span><span>
</span><span id="line-126"></span><span>            </span><span class="annot"><span class="annottext">StmtResult s
</span><a href="Interpreter.Interpreter.html#Continue"><span class="hs-identifier hs-var">Continue</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="annot"><span class="annottext">forall s. SimpleStmt -&gt; Result s (StmtResult s)
</span><a href="Interpreter.Interpreter.html#interpretStmtSimple"><span class="hs-identifier hs-var">interpretStmtSimple</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe SimpleStmt
</span><a href="#local-6989586621679168623"><span class="hs-identifier hs-var">post</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">ExceptT Err (StateT (Env s) (ST s)) (StmtResult s)
</span><a href="#local-6989586621679168619"><span class="hs-identifier hs-var">for</span></a></span><span>
</span><span id="line-127"></span><span>            </span><span class="annot"><a href="Interpreter.Interpreter.html#Ret"><span class="hs-identifier hs-type">Ret</span></a></span><span> </span><span class="annot"><span class="annottext">MaybeVoid (RuntimeValue s)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="annot"><span class="annottext">forall s. SimpleStmt -&gt; Result s (StmtResult s)
</span><a href="Interpreter.Interpreter.html#interpretStmtSimple"><span class="hs-identifier hs-var">interpretStmtSimple</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe SimpleStmt
</span><a href="#local-6989586621679168623"><span class="hs-identifier hs-var">post</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; b -&gt; f b
</span><span class="hs-operator hs-var">$&gt;</span></span><span> </span><span class="annot"><span class="annottext">StmtResult s
</span><a href="#local-6989586621679168592"><span class="hs-identifier hs-var">res</span></a></span><span>
</span><span id="line-128"></span><span>        </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">forall s. StmtResult s
</span><a href="Interpreter.Interpreter.html#Unit"><span class="hs-identifier hs-var">Unit</span></a></span><span>
</span><span id="line-129"></span><span>
</span><span id="line-130"></span><span id="local-6989586621679169013"><span class="annot"><a href="Interpreter.Interpreter.html#interpretStmtVarDecl"><span class="hs-identifier hs-type">interpretStmtVarDecl</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Analyzer.AnalyzedAst.html#VarDecl"><span class="hs-identifier hs-type">Ast.VarDecl</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Interpreter.Result.html#Result"><span class="hs-identifier hs-type">Result</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679169013"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Interpreter.Interpreter.html#StmtResult"><span class="hs-identifier hs-type">StmtResult</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679169013"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-131"></span><span id="interpretStmtVarDecl"><span class="annot"><span class="annottext">interpretStmtVarDecl :: forall s. VarDecl -&gt; Result s (StmtResult s)
</span><a href="Interpreter.Interpreter.html#interpretStmtVarDecl"><span class="hs-identifier hs-var hs-var">interpretStmtVarDecl</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Analyzer.AnalyzedAst.html#VarDecl"><span class="hs-identifier hs-type">Ast.VarDecl</span></a></span><span> </span><span id="local-6989586621679168584"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679168584"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621679168583"><span class="annot"><span class="annottext">Expression
</span><a href="#local-6989586621679168583"><span class="hs-identifier hs-var">expr</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall s. Expression -&gt; Result s (RuntimeValue s)
</span><a href="Interpreter.Interpreter.html#interpretExpr%27"><span class="hs-identifier hs-var">interpretExpr'</span></a></span><span> </span><span class="annot"><span class="annottext">Expression
</span><a href="#local-6989586621679168583"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">forall s. Text -&gt; RuntimeValue s -&gt; Result s ()
</span><a href="Interpreter.Runtime.html#addNewVar"><span class="hs-identifier hs-var">addNewVar</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679168584"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; b -&gt; f b
</span><span class="hs-operator hs-var">$&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall s. StmtResult s
</span><a href="Interpreter.Interpreter.html#Unit"><span class="hs-identifier hs-var">Unit</span></a></span><span>
</span><span id="line-132"></span><span>
</span><span id="line-133"></span><span id="local-6989586621679169011"><span class="annot"><a href="Interpreter.Interpreter.html#interpretStmtIfElse"><span class="hs-identifier hs-type">interpretStmtIfElse</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Analyzer.AnalyzedAst.html#IfElse"><span class="hs-identifier hs-type">Ast.IfElse</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Interpreter.Result.html#Result"><span class="hs-identifier hs-type">Result</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679169011"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Interpreter.Interpreter.html#StmtResult"><span class="hs-identifier hs-type">StmtResult</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679169011"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-134"></span><span id="interpretStmtIfElse"><span class="annot"><span class="annottext">interpretStmtIfElse :: forall s. IfElse -&gt; Result s (StmtResult s)
</span><a href="Interpreter.Interpreter.html#interpretStmtIfElse"><span class="hs-identifier hs-var hs-var">interpretStmtIfElse</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Analyzer.AnalyzedAst.html#IfElse"><span class="hs-identifier hs-type">Ast.IfElse</span></a></span><span> </span><span id="local-6989586621679168565"><span class="annot"><span class="annottext">Maybe SimpleStmt
</span><a href="#local-6989586621679168565"><span class="hs-identifier hs-var">preStmt</span></a></span></span><span> </span><span id="local-6989586621679168564"><span class="annot"><span class="annottext">Expression
</span><a href="#local-6989586621679168564"><span class="hs-identifier hs-var">condition</span></a></span></span><span> </span><span id="local-6989586621679168563"><span class="annot"><span class="annottext">Block
</span><a href="#local-6989586621679168563"><span class="hs-identifier hs-var">block</span></a></span></span><span> </span><span id="local-6989586621679168562"><span class="annot"><span class="annottext">Else
</span><a href="#local-6989586621679168562"><span class="hs-identifier hs-var">elseStmt</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-135"></span><span>  </span><span class="annot"><span class="annottext">forall s (m :: * -&gt; *). MonadState s m =&gt; (s -&gt; s) -&gt; m ()
</span><span class="hs-identifier hs-var">modify</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall s. Scope s -&gt; Env s -&gt; Env s
</span><a href="Interpreter.Runtime.html#pushBlockScope"><span class="hs-identifier hs-var">pushBlockScope</span></a></span><span> </span><span class="annot"><span class="annottext">forall s. Scope s
</span><a href="Interpreter.Result.html#emptyScope"><span class="hs-identifier hs-var">emptyScope</span></a></span><span>
</span><span id="line-136"></span><span>  </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="annot"><span class="annottext">forall s. SimpleStmt -&gt; Result s (StmtResult s)
</span><a href="Interpreter.Interpreter.html#interpretStmtSimple"><span class="hs-identifier hs-var">interpretStmtSimple</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe SimpleStmt
</span><a href="#local-6989586621679168565"><span class="hs-identifier hs-var">preStmt</span></a></span><span>
</span><span id="line-137"></span><span>  </span><span id="local-6989586621679168561"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679168561"><span class="hs-identifier hs-var">cond</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall s. Expression -&gt; Result s Bool
</span><a href="Interpreter.Interpreter.html#interpretBoolExpr"><span class="hs-identifier hs-var">interpretBoolExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expression
</span><a href="#local-6989586621679168564"><span class="hs-identifier hs-var">condition</span></a></span><span>
</span><span id="line-138"></span><span>  </span><span id="local-6989586621679168560"><span class="annot"><span class="annottext">StmtResult s
</span><a href="#local-6989586621679168560"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-139"></span><span>    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679168561"><span class="hs-identifier hs-var">cond</span></a></span><span>
</span><span id="line-140"></span><span>      </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">forall s. Scope s -&gt; Block -&gt; Result s (StmtResult s)
</span><a href="Interpreter.Interpreter.html#interpretBlock"><span class="hs-identifier hs-var">interpretBlock</span></a></span><span> </span><span class="annot"><span class="annottext">forall s. Scope s
</span><a href="Interpreter.Result.html#emptyScope"><span class="hs-identifier hs-var">emptyScope</span></a></span><span> </span><span class="annot"><span class="annottext">Block
</span><a href="#local-6989586621679168563"><span class="hs-identifier hs-var">block</span></a></span><span>
</span><span id="line-141"></span><span>      </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Else
</span><a href="#local-6989586621679168562"><span class="hs-identifier hs-var">elseStmt</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-142"></span><span>        </span><span class="annot"><span class="annottext">Else
</span><a href="Analyzer.AnalyzedAst.html#NoElse"><span class="hs-identifier hs-var">Ast.NoElse</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">forall s. StmtResult s
</span><a href="Interpreter.Interpreter.html#Unit"><span class="hs-identifier hs-var">Unit</span></a></span><span>
</span><span id="line-143"></span><span>        </span><span class="annot"><a href="Analyzer.AnalyzedAst.html#Else"><span class="hs-identifier hs-type">Ast.Else</span></a></span><span> </span><span id="local-6989586621679168557"><span class="annot"><span class="annottext">Block
</span><a href="#local-6989586621679168557"><span class="hs-identifier hs-var">block'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall s. Scope s -&gt; Block -&gt; Result s (StmtResult s)
</span><a href="Interpreter.Interpreter.html#interpretBlock"><span class="hs-identifier hs-var">interpretBlock</span></a></span><span> </span><span class="annot"><span class="annottext">forall s. Scope s
</span><a href="Interpreter.Result.html#emptyScope"><span class="hs-identifier hs-var">emptyScope</span></a></span><span> </span><span class="annot"><span class="annottext">Block
</span><a href="#local-6989586621679168557"><span class="hs-identifier hs-var">block'</span></a></span><span>
</span><span id="line-144"></span><span>        </span><span class="annot"><a href="Analyzer.AnalyzedAst.html#Elif"><span class="hs-identifier hs-type">Ast.Elif</span></a></span><span> </span><span id="local-6989586621679168555"><span class="annot"><span class="annottext">IfElse
</span><a href="#local-6989586621679168555"><span class="hs-identifier hs-var">ifElse</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall s. IfElse -&gt; Result s (StmtResult s)
</span><a href="Interpreter.Interpreter.html#interpretStmtIfElse"><span class="hs-identifier hs-var">interpretStmtIfElse</span></a></span><span> </span><span class="annot"><span class="annottext">IfElse
</span><a href="#local-6989586621679168555"><span class="hs-identifier hs-var">ifElse</span></a></span><span>
</span><span id="line-145"></span><span>  </span><span class="annot"><span class="annottext">forall s (m :: * -&gt; *). MonadState s m =&gt; (s -&gt; s) -&gt; m ()
</span><span class="hs-identifier hs-var">modify</span></span><span> </span><span class="annot"><span class="annottext">forall s. Env s -&gt; Env s
</span><a href="Interpreter.Runtime.html#popBlockScope"><span class="hs-identifier hs-var">popBlockScope</span></a></span><span>
</span><span id="line-146"></span><span>  </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">StmtResult s
</span><a href="#local-6989586621679168560"><span class="hs-identifier hs-var">res</span></a></span><span>
</span><span id="line-147"></span><span>
</span><span id="line-148"></span><span id="local-6989586621679169008"><span class="annot"><a href="Interpreter.Interpreter.html#interpretStmtSimple"><span class="hs-identifier hs-type">interpretStmtSimple</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Analyzer.AnalyzedAst.html#SimpleStmt"><span class="hs-identifier hs-type">Ast.SimpleStmt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Interpreter.Result.html#Result"><span class="hs-identifier hs-type">Result</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679169008"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Interpreter.Interpreter.html#StmtResult"><span class="hs-identifier hs-type">StmtResult</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679169008"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-149"></span><span id="interpretStmtSimple"><span class="annot"><span class="annottext">interpretStmtSimple :: forall s. SimpleStmt -&gt; Result s (StmtResult s)
</span><a href="Interpreter.Interpreter.html#interpretStmtSimple"><span class="hs-identifier hs-var hs-var">interpretStmtSimple</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-150"></span><span>  </span><span class="annot"><a href="Analyzer.AnalyzedAst.html#StmtAssignment"><span class="hs-identifier hs-type">Ast.StmtAssignment</span></a></span><span> </span><span id="local-6989586621679168538"><span class="annot"><span class="annottext">Lvalue
</span><a href="#local-6989586621679168538"><span class="hs-identifier hs-var">lval</span></a></span></span><span> </span><span id="local-6989586621679168537"><span class="annot"><span class="annottext">Expression
</span><a href="#local-6989586621679168537"><span class="hs-identifier hs-var">expr</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-151"></span><span>    </span><span id="local-6989586621679168536"><span class="annot"><span class="annottext">RuntimeValue s
</span><a href="#local-6989586621679168536"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall s. Expression -&gt; Result s (RuntimeValue s)
</span><a href="Interpreter.Interpreter.html#interpretExpr%27"><span class="hs-identifier hs-var">interpretExpr'</span></a></span><span> </span><span class="annot"><span class="annottext">Expression
</span><a href="#local-6989586621679168537"><span class="hs-identifier hs-var">expr</span></a></span><span>
</span><span id="line-152"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679168535"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679168535"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">RuntimeValue s
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679168534"><span class="annot"><span class="annottext">RuntimeValue s -&gt; RuntimeValue s
</span><a href="#local-6989586621679168534"><span class="hs-identifier hs-var">f</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall s.
Lvalue
-&gt; Result
     s (Text, RuntimeValue s, RuntimeValue s -&gt; RuntimeValue s)
</span><a href="Interpreter.Interpreter.html#getLvalueUpdater"><span class="hs-identifier hs-var">getLvalueUpdater</span></a></span><span> </span><span class="annot"><span class="annottext">Lvalue
</span><a href="#local-6989586621679168538"><span class="hs-identifier hs-var">lval</span></a></span><span>
</span><span id="line-153"></span><span>    </span><span class="annot"><span class="annottext">forall s. Text -&gt; RuntimeValue s -&gt; Result s ()
</span><a href="Interpreter.Runtime.html#updateVar"><span class="hs-identifier hs-var">updateVar</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679168535"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RuntimeValue s -&gt; RuntimeValue s
</span><a href="#local-6989586621679168534"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">RuntimeValue s
</span><a href="#local-6989586621679168536"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-154"></span><span>    </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">forall s. StmtResult s
</span><a href="Interpreter.Interpreter.html#Unit"><span class="hs-identifier hs-var">Unit</span></a></span><span>
</span><span id="line-155"></span><span>  </span><span class="annot"><a href="Analyzer.AnalyzedAst.html#StmtIncDec"><span class="hs-identifier hs-type">Ast.StmtIncDec</span></a></span><span> </span><span id="local-6989586621679168530"><span class="annot"><span class="annottext">Lvalue
</span><a href="#local-6989586621679168530"><span class="hs-identifier hs-var">lval</span></a></span></span><span> </span><span id="local-6989586621679168529"><span class="annot"><span class="annottext">IncDec
</span><a href="#local-6989586621679168529"><span class="hs-identifier hs-var">incDec</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-156"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679168523"><span class="annot"><span class="annottext">upd :: Int -&gt; Int
</span><a href="#local-6989586621679168523"><span class="hs-identifier hs-var hs-var">upd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">IncDec
</span><a href="#local-6989586621679168529"><span class="hs-identifier hs-var">incDec</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-157"></span><span>          </span><span class="annot"><span class="annottext">IncDec
</span><a href="Parser.Ast.html#Inc"><span class="hs-identifier hs-var">Ast.Inc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-158"></span><span>          </span><span class="annot"><span class="annottext">IncDec
</span><a href="Parser.Ast.html#Dec"><span class="hs-identifier hs-var">Ast.Dec</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679168519"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679168519"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679168519"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-159"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679168518"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679168518"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679168517"><span class="annot"><span class="annottext">RuntimeValue s
</span><a href="#local-6989586621679168517"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679168516"><span class="annot"><span class="annottext">RuntimeValue s -&gt; RuntimeValue s
</span><a href="#local-6989586621679168516"><span class="hs-identifier hs-var">f</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall s.
Lvalue
-&gt; Result
     s (Text, RuntimeValue s, RuntimeValue s -&gt; RuntimeValue s)
</span><a href="Interpreter.Interpreter.html#getLvalueUpdater"><span class="hs-identifier hs-var">getLvalueUpdater</span></a></span><span> </span><span class="annot"><span class="annottext">Lvalue
</span><a href="#local-6989586621679168530"><span class="hs-identifier hs-var">lval</span></a></span><span>
</span><span id="line-160"></span><span>    </span><span id="local-6989586621679168515"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679168515"><span class="hs-identifier hs-var">v'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall s. RuntimeValue s -&gt; Result s Int
</span><a href="Interpreter.Interpreter.html#castToInt"><span class="hs-identifier hs-var">castToInt</span></a></span><span> </span><span class="annot"><span class="annottext">RuntimeValue s
</span><a href="#local-6989586621679168517"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-161"></span><span>    </span><span class="annot"><span class="annottext">forall s. Text -&gt; RuntimeValue s -&gt; Result s ()
</span><a href="Interpreter.Runtime.html#updateVar"><span class="hs-identifier hs-var">updateVar</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679168518"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RuntimeValue s -&gt; RuntimeValue s
</span><a href="#local-6989586621679168516"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall s. Int -&gt; RuntimeValue s
</span><a href="Interpreter.Result.html#ValInt"><span class="hs-identifier hs-var">ValInt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int
</span><a href="#local-6989586621679168523"><span class="hs-identifier hs-var">upd</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679168515"><span class="hs-identifier hs-var">v'</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-162"></span><span>    </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">forall s. StmtResult s
</span><a href="Interpreter.Interpreter.html#Unit"><span class="hs-identifier hs-var">Unit</span></a></span><span>
</span><span id="line-163"></span><span>  </span><span class="annot"><a href="Analyzer.AnalyzedAst.html#StmtShortVarDecl"><span class="hs-identifier hs-type">Ast.StmtShortVarDecl</span></a></span><span> </span><span id="local-6989586621679168511"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679168511"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621679168510"><span class="annot"><span class="annottext">Expression
</span><a href="#local-6989586621679168510"><span class="hs-identifier hs-var">expr</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall s. Expression -&gt; Result s (RuntimeValue s)
</span><a href="Interpreter.Interpreter.html#interpretExpr%27"><span class="hs-identifier hs-var">interpretExpr'</span></a></span><span> </span><span class="annot"><span class="annottext">Expression
</span><a href="#local-6989586621679168510"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">forall s. Text -&gt; RuntimeValue s -&gt; Result s ()
</span><a href="Interpreter.Runtime.html#addOrUpdateVar"><span class="hs-identifier hs-var">addOrUpdateVar</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679168511"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; b -&gt; f b
</span><span class="hs-operator hs-var">$&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall s. StmtResult s
</span><a href="Interpreter.Interpreter.html#Unit"><span class="hs-identifier hs-var">Unit</span></a></span><span>
</span><span id="line-164"></span><span>  </span><span class="annot"><a href="Analyzer.AnalyzedAst.html#StmtExpression"><span class="hs-identifier hs-type">Ast.StmtExpression</span></a></span><span> </span><span id="local-6989586621679168507"><span class="annot"><span class="annottext">Expression
</span><a href="#local-6989586621679168507"><span class="hs-identifier hs-var">expr</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall s. Expression -&gt; Result s (MaybeVoid (RuntimeValue s))
</span><a href="Interpreter.Interpreter.html#interpretExpr"><span class="hs-identifier hs-var">interpretExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expression
</span><a href="#local-6989586621679168507"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; b -&gt; f b
</span><span class="hs-operator hs-var">$&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall s. StmtResult s
</span><a href="Interpreter.Interpreter.html#Unit"><span class="hs-identifier hs-var">Unit</span></a></span><span>
</span><span id="line-165"></span><span>
</span><span id="line-166"></span><span id="local-6989586621679168978"><span class="annot"><a href="Interpreter.Interpreter.html#getLvalueUpdater"><span class="hs-identifier hs-type">getLvalueUpdater</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Analyzer.AnalyzedAst.html#Lvalue"><span class="hs-identifier hs-type">Ast.Lvalue</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Interpreter.Result.html#Result"><span class="hs-identifier hs-type">Result</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679168978"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Analyzer.AnalyzedAst.html#Identifier"><span class="hs-identifier hs-type">Ast.Identifier</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Interpreter.Result.html#RuntimeValue"><span class="hs-identifier hs-type">RuntimeValue</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679168978"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Interpreter.Result.html#RuntimeValue"><span class="hs-identifier hs-type">RuntimeValue</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679168978"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Interpreter.Result.html#RuntimeValue"><span class="hs-identifier hs-type">RuntimeValue</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679168978"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-167"></span><span id="getLvalueUpdater"><span class="annot"><span class="annottext">getLvalueUpdater :: forall s.
Lvalue
-&gt; Result
     s (Text, RuntimeValue s, RuntimeValue s -&gt; RuntimeValue s)
</span><a href="Interpreter.Interpreter.html#getLvalueUpdater"><span class="hs-identifier hs-var hs-var">getLvalueUpdater</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Analyzer.AnalyzedAst.html#LvalVar"><span class="hs-identifier hs-type">Ast.LvalVar</span></a></span><span> </span><span id="local-6989586621679168491"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679168491"><span class="hs-identifier hs-var">name</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679168491"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">,</span><span class="hs-special">,</span><span class="annot"><span class="annottext">forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall s. Text -&gt; Result s (RuntimeValue s)
</span><a href="Interpreter.Runtime.html#getVarValue"><span class="hs-identifier hs-var">getVarValue</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679168491"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-168"></span><span class="annot"><a href="Interpreter.Interpreter.html#getLvalueUpdater"><span class="hs-identifier hs-var">getLvalueUpdater</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Analyzer.AnalyzedAst.html#LvalArrEl"><span class="hs-identifier hs-type">Ast.LvalArrEl</span></a></span><span> </span><span id="local-6989586621679168487"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679168487"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621679168486"><span class="annot"><span class="annottext">[Expression]
</span><a href="#local-6989586621679168486"><span class="hs-identifier hs-var">indices</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-169"></span><span>  </span><span id="local-6989586621679168485"><span class="annot"><span class="annottext">RuntimeValue s
</span><a href="#local-6989586621679168485"><span class="hs-identifier hs-var">arr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall s. Text -&gt; Result s (RuntimeValue s)
</span><a href="Interpreter.Runtime.html#getVarValue"><span class="hs-identifier hs-var">getVarValue</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679168487"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-170"></span><span>  </span><span id="local-6989586621679168484"><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621679168484"><span class="hs-identifier hs-var">indices'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">forall s. Expression -&gt; Result s Int
</span><a href="Interpreter.Interpreter.html#interpretIntExpr"><span class="hs-identifier hs-var">interpretIntExpr</span></a></span><span> </span><span class="annot"><span class="annottext">[Expression]
</span><a href="#local-6989586621679168486"><span class="hs-identifier hs-var">indices</span></a></span><span>
</span><span id="line-171"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679168482"><span class="annot"><span class="annottext">RuntimeValue s
</span><a href="#local-6989586621679168482"><span class="hs-identifier hs-var">value</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679168481"><span class="annot"><span class="annottext">RuntimeValue s -&gt; RuntimeValue s -&gt; RuntimeValue s
</span><a href="#local-6989586621679168481"><span class="hs-identifier hs-var">accessor</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (m :: * -&gt; *) b a.
(Foldable t, Monad m) =&gt;
(b -&gt; a -&gt; m b) -&gt; b -&gt; t a -&gt; m b
</span><span class="hs-identifier hs-var">foldM</span></span><span> </span><span class="annot"><span class="annottext">forall s.
(RuntimeValue s,
 RuntimeValue s -&gt; RuntimeValue s -&gt; RuntimeValue s)
-&gt; Int
-&gt; Result
     s
     (RuntimeValue s,
      RuntimeValue s -&gt; RuntimeValue s -&gt; RuntimeValue s)
</span><a href="#local-6989586621679168480"><span class="hs-identifier hs-var">helper</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RuntimeValue s
</span><a href="#local-6989586621679168485"><span class="hs-identifier hs-var">arr</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">RuntimeValue s
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679168479"><span class="annot"><span class="annottext">RuntimeValue s
</span><a href="#local-6989586621679168479"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">RuntimeValue s
</span><a href="#local-6989586621679168479"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621679168484"><span class="hs-identifier hs-var">indices'</span></a></span><span>
</span><span id="line-172"></span><span>  </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679168487"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">RuntimeValue s
</span><a href="#local-6989586621679168482"><span class="hs-identifier hs-var">value</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">RuntimeValue s -&gt; RuntimeValue s -&gt; RuntimeValue s
</span><a href="#local-6989586621679168481"><span class="hs-identifier hs-var">accessor</span></a></span><span> </span><span class="annot"><span class="annottext">RuntimeValue s
</span><a href="#local-6989586621679168485"><span class="hs-identifier hs-var">arr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-173"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-174"></span><span>    </span><span id="local-6989586621679168965"><span class="annot"><a href="#local-6989586621679168480"><span class="hs-identifier hs-type">helper</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-175"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="Interpreter.Result.html#RuntimeValue"><span class="hs-identifier hs-type">RuntimeValue</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679168965"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Interpreter.Result.html#RuntimeValue"><span class="hs-identifier hs-type">RuntimeValue</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679168965"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Interpreter.Result.html#RuntimeValue"><span class="hs-identifier hs-type">RuntimeValue</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679168965"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Interpreter.Result.html#RuntimeValue"><span class="hs-identifier hs-type">RuntimeValue</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679168965"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-176"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-177"></span><span>      </span><span class="annot"><a href="Interpreter.Result.html#Result"><span class="hs-identifier hs-type">Result</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679168965"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Interpreter.Result.html#RuntimeValue"><span class="hs-identifier hs-type">RuntimeValue</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679168965"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Interpreter.Result.html#RuntimeValue"><span class="hs-identifier hs-type">RuntimeValue</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679168965"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Interpreter.Result.html#RuntimeValue"><span class="hs-identifier hs-type">RuntimeValue</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679168965"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Interpreter.Result.html#RuntimeValue"><span class="hs-identifier hs-type">RuntimeValue</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679168965"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-178"></span><span>    </span><span id="local-6989586621679168480"><span class="annot"><span class="annottext">helper :: forall s.
(RuntimeValue s,
 RuntimeValue s -&gt; RuntimeValue s -&gt; RuntimeValue s)
-&gt; Int
-&gt; Result
     s
     (RuntimeValue s,
      RuntimeValue s -&gt; RuntimeValue s -&gt; RuntimeValue s)
</span><a href="#local-6989586621679168480"><span class="hs-identifier hs-var hs-var">helper</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679168470"><span class="annot"><span class="annottext">RuntimeValue s
</span><a href="#local-6989586621679168470"><span class="hs-identifier hs-var">arr</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679168469"><span class="annot"><span class="annottext">RuntimeValue s -&gt; RuntimeValue s -&gt; RuntimeValue s
</span><a href="#local-6989586621679168469"><span class="hs-identifier hs-var">replacer</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679168468"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679168468"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-179"></span><span>      </span><span id="local-6989586621679168467"><span class="annot"><span class="annottext">[RuntimeValue s]
</span><a href="#local-6989586621679168467"><span class="hs-identifier hs-var">arr'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall s. RuntimeValue s -&gt; Result s [RuntimeValue s]
</span><a href="Interpreter.Interpreter.html#castToArr"><span class="hs-identifier hs-var">castToArr</span></a></span><span> </span><span class="annot"><span class="annottext">RuntimeValue s
</span><a href="#local-6989586621679168470"><span class="hs-identifier hs-var">arr</span></a></span><span>
</span><span id="line-180"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679168458"><span class="annot"><span class="annottext">arrEl :: RuntimeValue s
</span><a href="#local-6989586621679168458"><span class="hs-identifier hs-var hs-var">arrEl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[RuntimeValue s]
</span><a href="#local-6989586621679168467"><span class="hs-identifier hs-var">arr'</span></a></span><span> </span><span class="annot"><span class="annottext">forall s a. HasCallStack =&gt; s -&gt; Getting (Endo a) s a -&gt; a
</span><span class="hs-operator hs-var">^?!</span></span><span> </span><span class="annot"><span class="annottext">forall m. Ixed m =&gt; Index m -&gt; Traversal' m (IxValue m)
</span><span class="hs-identifier hs-var">ix</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679168468"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-181"></span><span>      </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RuntimeValue s
</span><a href="#local-6989586621679168458"><span class="hs-identifier hs-var">arrEl</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679168457"><span class="annot"><span class="annottext">RuntimeValue s
</span><a href="#local-6989586621679168457"><span class="hs-identifier hs-var">oldArr</span></a></span></span><span> </span><span id="local-6989586621679168456"><span class="annot"><span class="annottext">RuntimeValue s
</span><a href="#local-6989586621679168456"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">RuntimeValue s -&gt; RuntimeValue s -&gt; RuntimeValue s
</span><a href="#local-6989586621679168469"><span class="hs-identifier hs-var">replacer</span></a></span><span> </span><span class="annot"><span class="annottext">RuntimeValue s
</span><a href="#local-6989586621679168457"><span class="hs-identifier hs-var">oldArr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall s. [RuntimeValue s] -&gt; RuntimeValue s
</span><a href="Interpreter.Result.html#ValArray"><span class="hs-identifier hs-var">ValArray</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[RuntimeValue s]
</span><a href="#local-6989586621679168467"><span class="hs-identifier hs-var">arr'</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">forall m. Ixed m =&gt; Index m -&gt; Traversal' m (IxValue m)
</span><span class="hs-identifier hs-var">ix</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679168468"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">forall s t a b. ASetter s t a b -&gt; b -&gt; s -&gt; t
</span><span class="hs-operator hs-var">.~</span></span><span> </span><span class="annot"><span class="annottext">RuntimeValue s
</span><a href="#local-6989586621679168456"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-182"></span><span>
</span><span id="line-183"></span><span class="hs-comment">-- | Statement interpretation result.</span><span>
</span><span id="line-184"></span><span class="hs-keyword">data</span><span> </span><span id="StmtResult"><span class="annot"><a href="Interpreter.Interpreter.html#StmtResult"><span class="hs-identifier hs-var">StmtResult</span></a></span></span><span> </span><span id="local-6989586621679169024"><span class="annot"><a href="#local-6989586621679169024"><span class="hs-identifier hs-type">s</span></a></span></span><span>
</span><span id="line-185"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">-- | Result of ordinary statement.</span><span>
</span><span id="line-186"></span><span>    </span><span id="Unit"><span class="annot"><a href="Interpreter.Interpreter.html#Unit"><span class="hs-identifier hs-var">Unit</span></a></span></span><span>
</span><span id="line-187"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-comment">-- | Result of the @break@ statement.</span><span>
</span><span id="line-188"></span><span>    </span><span id="Break"><span class="annot"><a href="Interpreter.Interpreter.html#Break"><span class="hs-identifier hs-var">Break</span></a></span></span><span>
</span><span id="line-189"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-comment">-- | Result of the @continue@ statement.</span><span>
</span><span id="line-190"></span><span>    </span><span id="Continue"><span class="annot"><a href="Interpreter.Interpreter.html#Continue"><span class="hs-identifier hs-var">Continue</span></a></span></span><span>
</span><span id="line-191"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-comment">-- | Result of the @return@ statement.</span><span>
</span><span id="line-192"></span><span>    </span><span id="Ret"><span class="annot"><a href="Interpreter.Interpreter.html#Ret"><span class="hs-identifier hs-var">Ret</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="MaybeVoid.html#MaybeVoid"><span class="hs-identifier hs-type">MaybeVoid</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Interpreter.Result.html#RuntimeValue"><span class="hs-identifier hs-type">RuntimeValue</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679169024"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-193"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679168448"><span id="local-6989586621679168453"><span class="annot"><span class="annottext">StmtResult s -&gt; StmtResult s -&gt; Bool
forall s. StmtResult s -&gt; StmtResult s -&gt; Bool
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: StmtResult s -&gt; StmtResult s -&gt; Bool
$c/= :: forall s. StmtResult s -&gt; StmtResult s -&gt; Bool
== :: StmtResult s -&gt; StmtResult s -&gt; Bool
$c== :: forall s. StmtResult s -&gt; StmtResult s -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-194"></span><span>
</span><span id="line-195"></span><span class="hs-comment">------------------------------------------------------Expressions-------------------------------------------------------</span><span>
</span><span id="line-196"></span><span>
</span><span id="line-197"></span><span id="local-6989586621679169001"><span class="annot"><a href="Interpreter.Interpreter.html#interpretExpr"><span class="hs-identifier hs-type">interpretExpr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Analyzer.AnalyzedAst.html#Expression"><span class="hs-identifier hs-type">Ast.Expression</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Interpreter.Result.html#Result"><span class="hs-identifier hs-type">Result</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679169001"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="MaybeVoid.html#MaybeVoid"><span class="hs-identifier hs-type">MaybeVoid</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Interpreter.Result.html#RuntimeValue"><span class="hs-identifier hs-type">RuntimeValue</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679169001"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span><span>
</span><span id="line-198"></span><span id="interpretExpr"><span class="annot"><span class="annottext">interpretExpr :: forall s. Expression -&gt; Result s (MaybeVoid (RuntimeValue s))
</span><a href="Interpreter.Interpreter.html#interpretExpr"><span class="hs-identifier hs-var hs-var">interpretExpr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-199"></span><span>  </span><span class="annot"><a href="Analyzer.AnalyzedAst.html#ExprValue"><span class="hs-identifier hs-type">Ast.ExprValue</span></a></span><span> </span><span id="local-6989586621679168444"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679168444"><span class="hs-identifier hs-var">value</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall s. Value -&gt; Result s (MaybeVoid (RuntimeValue s))
</span><a href="Interpreter.Interpreter.html#interpretExprValue"><span class="hs-identifier hs-var">interpretExprValue</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679168444"><span class="hs-identifier hs-var">value</span></a></span><span>
</span><span id="line-200"></span><span>  </span><span class="annot"><a href="Analyzer.AnalyzedAst.html#ExprIdentifier"><span class="hs-identifier hs-type">Ast.ExprIdentifier</span></a></span><span> </span><span id="local-6989586621679168441"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679168441"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall s. Text -&gt; Result s (MaybeVoid (RuntimeValue s))
</span><a href="Interpreter.Interpreter.html#interpretExprIdentifier"><span class="hs-identifier hs-var">interpretExprIdentifier</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679168441"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-201"></span><span>  </span><span class="annot"><a href="Analyzer.AnalyzedAst.html#ExprUnaryOp"><span class="hs-identifier hs-type">Ast.ExprUnaryOp</span></a></span><span> </span><span id="local-6989586621679168438"><span class="annot"><span class="annottext">UnaryOp
</span><a href="#local-6989586621679168438"><span class="hs-identifier hs-var">unOp</span></a></span></span><span> </span><span id="local-6989586621679168437"><span class="annot"><span class="annottext">Expression
</span><a href="#local-6989586621679168437"><span class="hs-identifier hs-var">expr</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall s.
UnaryOp -&gt; Expression -&gt; Result s (MaybeVoid (RuntimeValue s))
</span><a href="Interpreter.Interpreter.html#interpretExprUnaryOp"><span class="hs-identifier hs-var">interpretExprUnaryOp</span></a></span><span> </span><span class="annot"><span class="annottext">UnaryOp
</span><a href="#local-6989586621679168438"><span class="hs-identifier hs-var">unOp</span></a></span><span> </span><span class="annot"><span class="annottext">Expression
</span><a href="#local-6989586621679168437"><span class="hs-identifier hs-var">expr</span></a></span><span>
</span><span id="line-202"></span><span>  </span><span class="annot"><a href="Analyzer.AnalyzedAst.html#ExprBinaryOp"><span class="hs-identifier hs-type">Ast.ExprBinaryOp</span></a></span><span> </span><span id="local-6989586621679168434"><span class="annot"><span class="annottext">BinaryOp
</span><a href="#local-6989586621679168434"><span class="hs-identifier hs-var">binOp</span></a></span></span><span> </span><span id="local-6989586621679168433"><span class="annot"><span class="annottext">Expression
</span><a href="#local-6989586621679168433"><span class="hs-identifier hs-var">lhs</span></a></span></span><span> </span><span id="local-6989586621679168432"><span class="annot"><span class="annottext">Expression
</span><a href="#local-6989586621679168432"><span class="hs-identifier hs-var">rhs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall s.
BinaryOp
-&gt; Expression
-&gt; Expression
-&gt; Result s (MaybeVoid (RuntimeValue s))
</span><a href="Interpreter.Interpreter.html#interpretExprBinaryOp"><span class="hs-identifier hs-var">interpretExprBinaryOp</span></a></span><span> </span><span class="annot"><span class="annottext">BinaryOp
</span><a href="#local-6989586621679168434"><span class="hs-identifier hs-var">binOp</span></a></span><span> </span><span class="annot"><span class="annottext">Expression
</span><a href="#local-6989586621679168433"><span class="hs-identifier hs-var">lhs</span></a></span><span> </span><span class="annot"><span class="annottext">Expression
</span><a href="#local-6989586621679168432"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-203"></span><span>  </span><span class="annot"><a href="Analyzer.AnalyzedAst.html#ExprArrayAccessByIndex"><span class="hs-identifier hs-type">Ast.ExprArrayAccessByIndex</span></a></span><span> </span><span id="local-6989586621679168429"><span class="annot"><span class="annottext">Expression
</span><a href="#local-6989586621679168429"><span class="hs-identifier hs-var">arr</span></a></span></span><span> </span><span id="local-6989586621679168428"><span class="annot"><span class="annottext">Expression
</span><a href="#local-6989586621679168428"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall s.
Expression -&gt; Expression -&gt; Result s (MaybeVoid (RuntimeValue s))
</span><a href="Interpreter.Interpreter.html#interpretExprArrayAccessByIndex"><span class="hs-identifier hs-var">interpretExprArrayAccessByIndex</span></a></span><span> </span><span class="annot"><span class="annottext">Expression
</span><a href="#local-6989586621679168429"><span class="hs-identifier hs-var">arr</span></a></span><span> </span><span class="annot"><span class="annottext">Expression
</span><a href="#local-6989586621679168428"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-204"></span><span>  </span><span class="annot"><a href="Analyzer.AnalyzedAst.html#ExprFuncCall"><span class="hs-identifier hs-type">Ast.ExprFuncCall</span></a></span><span> </span><span id="local-6989586621679168425"><span class="annot"><span class="annottext">Expression
</span><a href="#local-6989586621679168425"><span class="hs-identifier hs-var">func</span></a></span></span><span> </span><span id="local-6989586621679168424"><span class="annot"><span class="annottext">[Expression]
</span><a href="#local-6989586621679168424"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall s.
Expression -&gt; [Expression] -&gt; Result s (MaybeVoid (RuntimeValue s))
</span><a href="Interpreter.Interpreter.html#interpretExprFuncCall"><span class="hs-identifier hs-var">interpretExprFuncCall</span></a></span><span> </span><span class="annot"><span class="annottext">Expression
</span><a href="#local-6989586621679168425"><span class="hs-identifier hs-var">func</span></a></span><span> </span><span class="annot"><span class="annottext">[Expression]
</span><a href="#local-6989586621679168424"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-205"></span><span>
</span><span id="line-206"></span><span id="local-6989586621679168946"><span class="annot"><a href="Interpreter.Interpreter.html#interpretExprValue"><span class="hs-identifier hs-type">interpretExprValue</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Analyzer.AnalyzedAst.html#Value"><span class="hs-identifier hs-type">Ast.Value</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Interpreter.Result.html#Result"><span class="hs-identifier hs-type">Result</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679168946"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="MaybeVoid.html#MaybeVoid"><span class="hs-identifier hs-type">MaybeVoid</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Interpreter.Result.html#RuntimeValue"><span class="hs-identifier hs-type">RuntimeValue</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679168946"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span><span>
</span><span id="line-207"></span><span id="interpretExprValue"><span class="annot"><span class="annottext">interpretExprValue :: forall s. Value -&gt; Result s (MaybeVoid (RuntimeValue s))
</span><a href="Interpreter.Interpreter.html#interpretExprValue"><span class="hs-identifier hs-var hs-var">interpretExprValue</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-208"></span><span>  </span><span class="annot"><a href="Analyzer.AnalyzedAst.html#ValInt"><span class="hs-identifier hs-type">Ast.ValInt</span></a></span><span> </span><span id="local-6989586621679168401"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679168401"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall {m :: * -&gt; *} {a}. Monad m =&gt; a -&gt; m (MaybeVoid a)
</span><a href="#local-6989586621679168400"><span class="hs-identifier hs-var">return'</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall s. Int -&gt; RuntimeValue s
</span><a href="Interpreter.Result.html#ValInt"><span class="hs-identifier hs-var">ValInt</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679168401"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-209"></span><span>  </span><span class="annot"><a href="Analyzer.AnalyzedAst.html#ValBool"><span class="hs-identifier hs-type">Ast.ValBool</span></a></span><span> </span><span id="local-6989586621679168398"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679168398"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall {m :: * -&gt; *} {a}. Monad m =&gt; a -&gt; m (MaybeVoid a)
</span><a href="#local-6989586621679168400"><span class="hs-identifier hs-var">return'</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall s. Bool -&gt; RuntimeValue s
</span><a href="Interpreter.Result.html#ValBool"><span class="hs-identifier hs-var">ValBool</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679168398"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-210"></span><span>  </span><span class="annot"><a href="Analyzer.AnalyzedAst.html#ValString"><span class="hs-identifier hs-type">Ast.ValString</span></a></span><span> </span><span id="local-6989586621679168395"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679168395"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall {m :: * -&gt; *} {a}. Monad m =&gt; a -&gt; m (MaybeVoid a)
</span><a href="#local-6989586621679168400"><span class="hs-identifier hs-var">return'</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall s. Text -&gt; RuntimeValue s
</span><a href="Interpreter.Result.html#ValString"><span class="hs-identifier hs-var">ValString</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679168395"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-211"></span><span>  </span><span class="annot"><a href="Analyzer.AnalyzedAst.html#ValArray"><span class="hs-identifier hs-type">Ast.ValArray</span></a></span><span> </span><span id="local-6989586621679168392"><span class="annot"><span class="annottext">[Expression]
</span><a href="#local-6989586621679168392"><span class="hs-identifier hs-var">es</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">forall s. Expression -&gt; Result s (RuntimeValue s)
</span><a href="Interpreter.Interpreter.html#interpretExpr%27"><span class="hs-identifier hs-var">interpretExpr'</span></a></span><span> </span><span class="annot"><span class="annottext">[Expression]
</span><a href="#local-6989586621679168392"><span class="hs-identifier hs-var">es</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">forall {m :: * -&gt; *} {a}. Monad m =&gt; a -&gt; m (MaybeVoid a)
</span><a href="#local-6989586621679168400"><span class="hs-identifier hs-var">return'</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall s. [RuntimeValue s] -&gt; RuntimeValue s
</span><a href="Interpreter.Result.html#ValArray"><span class="hs-identifier hs-var">ValArray</span></a></span><span>
</span><span id="line-212"></span><span>  </span><span class="annot"><a href="Analyzer.AnalyzedAst.html#ValFunction"><span class="hs-identifier hs-type">Ast.ValFunction</span></a></span><span> </span><span id="local-6989586621679168390"><span class="annot"><span class="annottext">FunctionValue
</span><a href="#local-6989586621679168390"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-213"></span><span>    </span><span id="local-6989586621679168389"><span class="annot"><span class="annottext">Env s
</span><a href="#local-6989586621679168389"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall s (m :: * -&gt; *). MonadState s m =&gt; m s
</span><span class="hs-identifier hs-var">get</span></span><span>
</span><span id="line-214"></span><span>    </span><span class="annot"><span class="annottext">forall {m :: * -&gt; *} {a}. Monad m =&gt; a -&gt; m (MaybeVoid a)
</span><a href="#local-6989586621679168400"><span class="hs-identifier hs-var">return'</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall s. FunctionValue -&gt; Scope s -&gt; RuntimeValue s
</span><a href="Interpreter.Result.html#ValFunction"><span class="hs-identifier hs-var">ValFunction</span></a></span><span> </span><span class="annot"><span class="annottext">FunctionValue
</span><a href="#local-6989586621679168390"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall s. FuncScope s -&gt; Scope s
</span><a href="Interpreter.Runtime.html#flattenFuncScope"><span class="hs-identifier hs-var">flattenFuncScope</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Env s
</span><a href="#local-6989586621679168389"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">forall s a. HasCallStack =&gt; s -&gt; Getting (Endo a) s a -&gt; a
</span><span class="hs-operator hs-var">^?!</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall s. Lens' (Env s) [FuncScope s]
</span><a href="Interpreter.Result.html#funcScopes"><span class="hs-identifier hs-var">funcScopes</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall m. Ixed m =&gt; Index m -&gt; Traversal' m (IxValue m)
</span><span class="hs-identifier hs-var">ix</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-215"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-216"></span><span>    </span><span id="local-6989586621679168400"><span class="annot"><span class="annottext">return' :: a -&gt; m (MaybeVoid a)
</span><a href="#local-6989586621679168400"><span class="hs-identifier hs-var hs-var">return'</span></a></span></span><span> </span><span id="local-6989586621679168383"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679168383"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; MaybeVoid a
</span><a href="MaybeVoid.html#NonVoid"><span class="hs-identifier hs-var">NonVoid</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679168383"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-217"></span><span>
</span><span id="line-218"></span><span id="local-6989586621679168945"><span class="annot"><a href="Interpreter.Interpreter.html#interpretExprIdentifier"><span class="hs-identifier hs-type">interpretExprIdentifier</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Analyzer.AnalyzedAst.html#Identifier"><span class="hs-identifier hs-type">Ast.Identifier</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Interpreter.Result.html#Result"><span class="hs-identifier hs-type">Result</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679168945"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="MaybeVoid.html#MaybeVoid"><span class="hs-identifier hs-type">MaybeVoid</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Interpreter.Result.html#RuntimeValue"><span class="hs-identifier hs-type">RuntimeValue</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679168945"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span><span>
</span><span id="line-219"></span><span id="interpretExprIdentifier"><span class="annot"><span class="annottext">interpretExprIdentifier :: forall s. Text -&gt; Result s (MaybeVoid (RuntimeValue s))
</span><a href="Interpreter.Interpreter.html#interpretExprIdentifier"><span class="hs-identifier hs-var hs-var">interpretExprIdentifier</span></a></span></span><span> </span><span id="local-6989586621679168378"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679168378"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; MaybeVoid a
</span><a href="MaybeVoid.html#NonVoid"><span class="hs-identifier hs-var">NonVoid</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall s. Text -&gt; Result s (RuntimeValue s)
</span><a href="Interpreter.Runtime.html#getVarValue"><span class="hs-identifier hs-var">getVarValue</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679168378"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-220"></span><span>
</span><span id="line-221"></span><span id="local-6989586621679168943"><span class="annot"><a href="Interpreter.Interpreter.html#interpretExprUnaryOp"><span class="hs-identifier hs-type">interpretExprUnaryOp</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Parser.Ast.html#UnaryOp"><span class="hs-identifier hs-type">Ast.UnaryOp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Analyzer.AnalyzedAst.html#Expression"><span class="hs-identifier hs-type">Ast.Expression</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Interpreter.Result.html#Result"><span class="hs-identifier hs-type">Result</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679168943"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="MaybeVoid.html#MaybeVoid"><span class="hs-identifier hs-type">MaybeVoid</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Interpreter.Result.html#RuntimeValue"><span class="hs-identifier hs-type">RuntimeValue</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679168943"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span><span>
</span><span id="line-222"></span><span id="interpretExprUnaryOp"><span class="annot"><span class="annottext">interpretExprUnaryOp :: forall s.
UnaryOp -&gt; Expression -&gt; Result s (MaybeVoid (RuntimeValue s))
</span><a href="Interpreter.Interpreter.html#interpretExprUnaryOp"><span class="hs-identifier hs-var hs-var">interpretExprUnaryOp</span></a></span></span><span> </span><span id="local-6989586621679168371"><span class="annot"><span class="annottext">UnaryOp
</span><a href="#local-6989586621679168371"><span class="hs-identifier hs-var">unOp</span></a></span></span><span> </span><span id="local-6989586621679168370"><span class="annot"><span class="annottext">Expression
</span><a href="#local-6989586621679168370"><span class="hs-identifier hs-var">expr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-223"></span><span>  </span><span class="annot"><span class="annottext">forall s. Expression -&gt; Result s (RuntimeValue s)
</span><a href="Interpreter.Interpreter.html#interpretExpr%27"><span class="hs-identifier hs-var">interpretExpr'</span></a></span><span> </span><span class="annot"><span class="annottext">Expression
</span><a href="#local-6989586621679168370"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">forall s. RuntimeValue s -&gt; Result s (PrimitiveValue Int)
</span><a href="Interpreter.Interpreter.html#valueToPrimitive"><span class="hs-identifier hs-var">valueToPrimitive</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">forall s.
Either Err (PrimitiveValue Int)
-&gt; Result s (MaybeVoid (RuntimeValue s))
</span><a href="Interpreter.Interpreter.html#liftPV"><span class="hs-identifier hs-var">liftPV</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall num.
Integral num =&gt;
UnaryOp -&gt; PrimitiveValue num -&gt; Either Err (PrimitiveValue num)
</span><a href="PrimitiveValue.html#primitiveUnOpApplication"><span class="hs-identifier hs-var">PV.primitiveUnOpApplication</span></a></span><span> </span><span class="annot"><span class="annottext">UnaryOp
</span><a href="#local-6989586621679168371"><span class="hs-identifier hs-var">unOp</span></a></span><span>
</span><span id="line-224"></span><span>
</span><span id="line-225"></span><span id="local-6989586621679168941"><span class="annot"><a href="Interpreter.Interpreter.html#interpretExprBinaryOp"><span class="hs-identifier hs-type">interpretExprBinaryOp</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Parser.Ast.html#BinaryOp"><span class="hs-identifier hs-type">Ast.BinaryOp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Analyzer.AnalyzedAst.html#Expression"><span class="hs-identifier hs-type">Ast.Expression</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Analyzer.AnalyzedAst.html#Expression"><span class="hs-identifier hs-type">Ast.Expression</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Interpreter.Result.html#Result"><span class="hs-identifier hs-type">Result</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679168941"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="MaybeVoid.html#MaybeVoid"><span class="hs-identifier hs-type">MaybeVoid</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Interpreter.Result.html#RuntimeValue"><span class="hs-identifier hs-type">RuntimeValue</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679168941"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span><span>
</span><span id="line-226"></span><span id="interpretExprBinaryOp"><span class="annot"><span class="annottext">interpretExprBinaryOp :: forall s.
BinaryOp
-&gt; Expression
-&gt; Expression
-&gt; Result s (MaybeVoid (RuntimeValue s))
</span><a href="Interpreter.Interpreter.html#interpretExprBinaryOp"><span class="hs-identifier hs-var hs-var">interpretExprBinaryOp</span></a></span></span><span> </span><span class="annot"><span class="annottext">BinaryOp
</span><a href="Parser.Ast.html#OrOp"><span class="hs-identifier hs-var">Ast.OrOp</span></a></span><span> </span><span id="local-6989586621679168346"><span class="annot"><span class="annottext">Expression
</span><a href="#local-6989586621679168346"><span class="hs-identifier hs-var">lhs</span></a></span></span><span> </span><span id="local-6989586621679168345"><span class="annot"><span class="annottext">Expression
</span><a href="#local-6989586621679168345"><span class="hs-identifier hs-var">rhs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-227"></span><span>  </span><span id="local-6989586621679168344"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679168344"><span class="hs-identifier hs-var">lhs'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall s. Expression -&gt; Result s Bool
</span><a href="Interpreter.Interpreter.html#interpretBoolExpr"><span class="hs-identifier hs-var">interpretBoolExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expression
</span><a href="#local-6989586621679168346"><span class="hs-identifier hs-var">lhs</span></a></span><span>
</span><span id="line-228"></span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679168344"><span class="hs-identifier hs-var">lhs'</span></a></span><span>
</span><span id="line-229"></span><span>    </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; MaybeVoid a
</span><a href="MaybeVoid.html#NonVoid"><span class="hs-identifier hs-var">NonVoid</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall s. Bool -&gt; RuntimeValue s
</span><a href="Interpreter.Result.html#ValBool"><span class="hs-identifier hs-var">ValBool</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-230"></span><span>    </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; MaybeVoid a
</span><a href="MaybeVoid.html#NonVoid"><span class="hs-identifier hs-var">NonVoid</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall s. Bool -&gt; RuntimeValue s
</span><a href="Interpreter.Result.html#ValBool"><span class="hs-identifier hs-var">ValBool</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall s. Expression -&gt; Result s Bool
</span><a href="Interpreter.Interpreter.html#interpretBoolExpr"><span class="hs-identifier hs-var">interpretBoolExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expression
</span><a href="#local-6989586621679168345"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-231"></span><span class="annot"><a href="Interpreter.Interpreter.html#interpretExprBinaryOp"><span class="hs-identifier hs-var">interpretExprBinaryOp</span></a></span><span> </span><span class="annot"><span class="annottext">BinaryOp
</span><a href="Parser.Ast.html#AndOp"><span class="hs-identifier hs-var">Ast.AndOp</span></a></span><span> </span><span id="local-6989586621679168342"><span class="annot"><span class="annottext">Expression
</span><a href="#local-6989586621679168342"><span class="hs-identifier hs-var">lhs</span></a></span></span><span> </span><span id="local-6989586621679168341"><span class="annot"><span class="annottext">Expression
</span><a href="#local-6989586621679168341"><span class="hs-identifier hs-var">rhs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-232"></span><span>  </span><span id="local-6989586621679168340"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679168340"><span class="hs-identifier hs-var">lhs'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall s. Expression -&gt; Result s Bool
</span><a href="Interpreter.Interpreter.html#interpretBoolExpr"><span class="hs-identifier hs-var">interpretBoolExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expression
</span><a href="#local-6989586621679168342"><span class="hs-identifier hs-var">lhs</span></a></span><span>
</span><span id="line-233"></span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679168340"><span class="hs-identifier hs-var">lhs'</span></a></span><span>
</span><span id="line-234"></span><span>    </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; MaybeVoid a
</span><a href="MaybeVoid.html#NonVoid"><span class="hs-identifier hs-var">NonVoid</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall s. Bool -&gt; RuntimeValue s
</span><a href="Interpreter.Result.html#ValBool"><span class="hs-identifier hs-var">ValBool</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-235"></span><span>    </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; MaybeVoid a
</span><a href="MaybeVoid.html#NonVoid"><span class="hs-identifier hs-var">NonVoid</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall s. Bool -&gt; RuntimeValue s
</span><a href="Interpreter.Result.html#ValBool"><span class="hs-identifier hs-var">ValBool</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall s. Expression -&gt; Result s Bool
</span><a href="Interpreter.Interpreter.html#interpretBoolExpr"><span class="hs-identifier hs-var">interpretBoolExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expression
</span><a href="#local-6989586621679168341"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-236"></span><span class="annot"><a href="Interpreter.Interpreter.html#interpretExprBinaryOp"><span class="hs-identifier hs-var">interpretExprBinaryOp</span></a></span><span> </span><span id="local-6989586621679168338"><span class="annot"><span class="annottext">BinaryOp
</span><a href="#local-6989586621679168338"><span class="hs-identifier hs-var">binOp</span></a></span></span><span> </span><span id="local-6989586621679168337"><span class="annot"><span class="annottext">Expression
</span><a href="#local-6989586621679168337"><span class="hs-identifier hs-var">lhs</span></a></span></span><span> </span><span id="local-6989586621679168336"><span class="annot"><span class="annottext">Expression
</span><a href="#local-6989586621679168336"><span class="hs-identifier hs-var">rhs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-237"></span><span>  </span><span id="local-6989586621679168335"><span class="annot"><span class="annottext">RuntimeValue s
</span><a href="#local-6989586621679168335"><span class="hs-identifier hs-var">lhsVal</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall s. Expression -&gt; Result s (RuntimeValue s)
</span><a href="Interpreter.Interpreter.html#interpretExpr%27"><span class="hs-identifier hs-var">interpretExpr'</span></a></span><span> </span><span class="annot"><span class="annottext">Expression
</span><a href="#local-6989586621679168337"><span class="hs-identifier hs-var">lhs</span></a></span><span>
</span><span id="line-238"></span><span>  </span><span id="local-6989586621679168334"><span class="annot"><span class="annottext">RuntimeValue s
</span><a href="#local-6989586621679168334"><span class="hs-identifier hs-var">rhsVal</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall s. Expression -&gt; Result s (RuntimeValue s)
</span><a href="Interpreter.Interpreter.html#interpretExpr%27"><span class="hs-identifier hs-var">interpretExpr'</span></a></span><span> </span><span class="annot"><span class="annottext">Expression
</span><a href="#local-6989586621679168336"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-239"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">BinaryOp
</span><a href="#local-6989586621679168338"><span class="hs-identifier hs-var">binOp</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-240"></span><span>    </span><span class="annot"><span class="annottext">BinaryOp
</span><a href="Parser.Ast.html#EqOp"><span class="hs-identifier hs-var">Ast.EqOp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; MaybeVoid a
</span><a href="MaybeVoid.html#NonVoid"><span class="hs-identifier hs-var">NonVoid</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall s. Bool -&gt; RuntimeValue s
</span><a href="Interpreter.Result.html#ValBool"><span class="hs-identifier hs-var">ValBool</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">RuntimeValue s
</span><a href="#local-6989586621679168335"><span class="hs-identifier hs-var">lhsVal</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">RuntimeValue s
</span><a href="#local-6989586621679168334"><span class="hs-identifier hs-var">rhsVal</span></a></span><span>
</span><span id="line-241"></span><span>    </span><span class="annot"><span class="annottext">BinaryOp
</span><a href="Parser.Ast.html#NeOp"><span class="hs-identifier hs-var">Ast.NeOp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; MaybeVoid a
</span><a href="MaybeVoid.html#NonVoid"><span class="hs-identifier hs-var">NonVoid</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall s. Bool -&gt; RuntimeValue s
</span><a href="Interpreter.Result.html#ValBool"><span class="hs-identifier hs-var">ValBool</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">RuntimeValue s
</span><a href="#local-6989586621679168335"><span class="hs-identifier hs-var">lhsVal</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">RuntimeValue s
</span><a href="#local-6989586621679168334"><span class="hs-identifier hs-var">rhsVal</span></a></span><span>
</span><span id="line-242"></span><span>    </span><span class="annot"><span class="annottext">BinaryOp
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-243"></span><span>      </span><span id="local-6989586621679168330"><span class="annot"><span class="annottext">PrimitiveValue Int
</span><a href="#local-6989586621679168330"><span class="hs-identifier hs-var">lhsPV</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall s. RuntimeValue s -&gt; Result s (PrimitiveValue Int)
</span><a href="Interpreter.Interpreter.html#valueToPrimitive"><span class="hs-identifier hs-var">valueToPrimitive</span></a></span><span> </span><span class="annot"><span class="annottext">RuntimeValue s
</span><a href="#local-6989586621679168335"><span class="hs-identifier hs-var">lhsVal</span></a></span><span>
</span><span id="line-244"></span><span>      </span><span id="local-6989586621679168329"><span class="annot"><span class="annottext">PrimitiveValue Int
</span><a href="#local-6989586621679168329"><span class="hs-identifier hs-var">rhsPV</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall s. RuntimeValue s -&gt; Result s (PrimitiveValue Int)
</span><a href="Interpreter.Interpreter.html#valueToPrimitive"><span class="hs-identifier hs-var">valueToPrimitive</span></a></span><span> </span><span class="annot"><span class="annottext">RuntimeValue s
</span><a href="#local-6989586621679168334"><span class="hs-identifier hs-var">rhsVal</span></a></span><span>
</span><span id="line-245"></span><span>      </span><span class="annot"><span class="annottext">forall s.
Either Err (PrimitiveValue Int)
-&gt; Result s (MaybeVoid (RuntimeValue s))
</span><a href="Interpreter.Interpreter.html#liftPV"><span class="hs-identifier hs-var">liftPV</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall num.
Integral num =&gt;
BinaryOp
-&gt; PrimitiveValue num
-&gt; PrimitiveValue num
-&gt; Either Err (PrimitiveValue num)
</span><a href="PrimitiveValue.html#primitiveBinOpApplication"><span class="hs-identifier hs-var">PV.primitiveBinOpApplication</span></a></span><span> </span><span class="annot"><span class="annottext">BinaryOp
</span><a href="#local-6989586621679168338"><span class="hs-identifier hs-var">binOp</span></a></span><span> </span><span class="annot"><span class="annottext">PrimitiveValue Int
</span><a href="#local-6989586621679168330"><span class="hs-identifier hs-var">lhsPV</span></a></span><span> </span><span class="annot"><span class="annottext">PrimitiveValue Int
</span><a href="#local-6989586621679168329"><span class="hs-identifier hs-var">rhsPV</span></a></span><span>
</span><span id="line-246"></span><span>
</span><span id="line-247"></span><span id="local-6989586621679168940"><span class="annot"><a href="Interpreter.Interpreter.html#interpretExprArrayAccessByIndex"><span class="hs-identifier hs-type">interpretExprArrayAccessByIndex</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Analyzer.AnalyzedAst.html#Expression"><span class="hs-identifier hs-type">Ast.Expression</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Analyzer.AnalyzedAst.html#Expression"><span class="hs-identifier hs-type">Ast.Expression</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Interpreter.Result.html#Result"><span class="hs-identifier hs-type">Result</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679168940"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="MaybeVoid.html#MaybeVoid"><span class="hs-identifier hs-type">MaybeVoid</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Interpreter.Result.html#RuntimeValue"><span class="hs-identifier hs-type">RuntimeValue</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679168940"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span><span>
</span><span id="line-248"></span><span id="interpretExprArrayAccessByIndex"><span class="annot"><span class="annottext">interpretExprArrayAccessByIndex :: forall s.
Expression -&gt; Expression -&gt; Result s (MaybeVoid (RuntimeValue s))
</span><a href="Interpreter.Interpreter.html#interpretExprArrayAccessByIndex"><span class="hs-identifier hs-var hs-var">interpretExprArrayAccessByIndex</span></a></span></span><span> </span><span id="local-6989586621679168320"><span class="annot"><span class="annottext">Expression
</span><a href="#local-6989586621679168320"><span class="hs-identifier hs-var">arr</span></a></span></span><span> </span><span id="local-6989586621679168319"><span class="annot"><span class="annottext">Expression
</span><a href="#local-6989586621679168319"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-249"></span><span>  </span><span id="local-6989586621679168318"><span class="annot"><span class="annottext">[RuntimeValue s]
</span><a href="#local-6989586621679168318"><span class="hs-identifier hs-var">arr'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall s. Expression -&gt; Result s [RuntimeValue s]
</span><a href="Interpreter.Interpreter.html#interpretArrExpr"><span class="hs-identifier hs-var">interpretArrExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expression
</span><a href="#local-6989586621679168320"><span class="hs-identifier hs-var">arr</span></a></span><span>
</span><span id="line-250"></span><span>  </span><span id="local-6989586621679168316"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679168316"><span class="hs-identifier hs-var">i'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall s. Expression -&gt; Result s Int
</span><a href="Interpreter.Interpreter.html#interpretIntExpr"><span class="hs-identifier hs-var">interpretIntExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expression
</span><a href="#local-6989586621679168319"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-251"></span><span>  </span><span class="annot"><span class="annottext">forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Err
</span><a href="Interpreter.Result.html#IndexOutOfRange"><span class="hs-identifier hs-var">IndexOutOfRange</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679168316"><span class="hs-identifier hs-var">i'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[RuntimeValue s]
</span><a href="#local-6989586621679168318"><span class="hs-identifier hs-var">arr'</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; MaybeVoid a
</span><a href="MaybeVoid.html#NonVoid"><span class="hs-identifier hs-var">NonVoid</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[RuntimeValue s]
</span><a href="#local-6989586621679168318"><span class="hs-identifier hs-var">arr'</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; Int -&gt; Maybe a
</span><span class="hs-operator hs-var">!?</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679168316"><span class="hs-identifier hs-var">i'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-252"></span><span>
</span><span id="line-253"></span><span id="local-6989586621679168939"><span class="annot"><a href="Interpreter.Interpreter.html#interpretExprFuncCall"><span class="hs-identifier hs-type">interpretExprFuncCall</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Analyzer.AnalyzedAst.html#Expression"><span class="hs-identifier hs-type">Ast.Expression</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Analyzer.AnalyzedAst.html#Expression"><span class="hs-identifier hs-type">Ast.Expression</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Interpreter.Result.html#Result"><span class="hs-identifier hs-type">Result</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679168939"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="MaybeVoid.html#MaybeVoid"><span class="hs-identifier hs-type">MaybeVoid</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Interpreter.Result.html#RuntimeValue"><span class="hs-identifier hs-type">RuntimeValue</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679168939"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span><span>
</span><span id="line-254"></span><span id="interpretExprFuncCall"><span class="annot"><span class="annottext">interpretExprFuncCall :: forall s.
Expression -&gt; [Expression] -&gt; Result s (MaybeVoid (RuntimeValue s))
</span><a href="Interpreter.Interpreter.html#interpretExprFuncCall"><span class="hs-identifier hs-var hs-var">interpretExprFuncCall</span></a></span></span><span> </span><span id="local-6989586621679168306"><span class="annot"><span class="annottext">Expression
</span><a href="#local-6989586621679168306"><span class="hs-identifier hs-var">func</span></a></span></span><span> </span><span id="local-6989586621679168305"><span class="annot"><span class="annottext">[Expression]
</span><a href="#local-6989586621679168305"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-255"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679168304"><span class="annot"><span class="annottext">Function
</span><a href="#local-6989586621679168304"><span class="hs-identifier hs-var">func'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679168303"><span class="annot"><span class="annottext">Scope s
</span><a href="#local-6989586621679168303"><span class="hs-identifier hs-var">sc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall s. Expression -&gt; Result s (Function, Scope s)
</span><a href="Interpreter.Interpreter.html#interpretFuncExpr"><span class="hs-identifier hs-var">interpretFuncExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expression
</span><a href="#local-6989586621679168306"><span class="hs-identifier hs-var">func</span></a></span><span>
</span><span id="line-256"></span><span>  </span><span id="local-6989586621679168301"><span class="annot"><span class="annottext">[RuntimeValue s]
</span><a href="#local-6989586621679168301"><span class="hs-identifier hs-var">args'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">forall s. Expression -&gt; Result s (RuntimeValue s)
</span><a href="Interpreter.Interpreter.html#interpretExpr%27"><span class="hs-identifier hs-var">interpretExpr'</span></a></span><span> </span><span class="annot"><span class="annottext">[Expression]
</span><a href="#local-6989586621679168305"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-257"></span><span>  </span><span class="annot"><span class="annottext">forall s.
Function
-&gt; Scope s
-&gt; [RuntimeValue s]
-&gt; Result s (MaybeVoid (RuntimeValue s))
</span><a href="Interpreter.Interpreter.html#interpretFunc"><span class="hs-identifier hs-var">interpretFunc</span></a></span><span> </span><span class="annot"><span class="annottext">Function
</span><a href="#local-6989586621679168304"><span class="hs-identifier hs-var">func'</span></a></span><span> </span><span class="annot"><span class="annottext">Scope s
</span><a href="#local-6989586621679168303"><span class="hs-identifier hs-var">sc</span></a></span><span> </span><span class="annot"><span class="annottext">[RuntimeValue s]
</span><a href="#local-6989586621679168301"><span class="hs-identifier hs-var">args'</span></a></span><span>
</span><span id="line-258"></span><span>
</span><span id="line-259"></span><span class="hs-comment">---------------------------------------------------------Utils----------------------------------------------------------</span><span>
</span><span id="line-260"></span><span>
</span><span id="line-261"></span><span class="hs-comment">-- * Utils</span><span>
</span><span id="line-262"></span><span>
</span><span id="line-263"></span><span class="hs-comment">-- ** Interpret non-void Expression</span><span>
</span><span id="line-264"></span><span>
</span><span id="line-265"></span><span id="local-6989586621679168970"><span class="annot"><a href="Interpreter.Interpreter.html#interpretIntExpr"><span class="hs-identifier hs-type">interpretIntExpr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Analyzer.AnalyzedAst.html#Expression"><span class="hs-identifier hs-type">Ast.Expression</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Interpreter.Result.html#Result"><span class="hs-identifier hs-type">Result</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679168970"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span></span><span>
</span><span id="line-266"></span><span id="interpretIntExpr"><span class="annot"><span class="annottext">interpretIntExpr :: forall s. Expression -&gt; Result s Int
</span><a href="Interpreter.Interpreter.html#interpretIntExpr"><span class="hs-identifier hs-var hs-var">interpretIntExpr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall s. Expression -&gt; Result s (RuntimeValue s)
</span><a href="Interpreter.Interpreter.html#interpretExpr%27"><span class="hs-identifier hs-var">interpretExpr'</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b c.
Monad m =&gt;
(a -&gt; m b) -&gt; (b -&gt; m c) -&gt; a -&gt; m c
</span><span class="hs-operator hs-var">&gt;=&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall s. RuntimeValue s -&gt; Result s Int
</span><a href="Interpreter.Interpreter.html#castToInt"><span class="hs-identifier hs-var">castToInt</span></a></span><span>
</span><span id="line-267"></span><span>
</span><span id="line-268"></span><span id="local-6989586621679168990"><span class="annot"><a href="Interpreter.Interpreter.html#interpretBoolExpr"><span class="hs-identifier hs-type">interpretBoolExpr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Analyzer.AnalyzedAst.html#Expression"><span class="hs-identifier hs-type">Ast.Expression</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Interpreter.Result.html#Result"><span class="hs-identifier hs-type">Result</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679168990"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span><span>
</span><span id="line-269"></span><span id="interpretBoolExpr"><span class="annot"><span class="annottext">interpretBoolExpr :: forall s. Expression -&gt; Result s Bool
</span><a href="Interpreter.Interpreter.html#interpretBoolExpr"><span class="hs-identifier hs-var hs-var">interpretBoolExpr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall s. Expression -&gt; Result s (RuntimeValue s)
</span><a href="Interpreter.Interpreter.html#interpretExpr%27"><span class="hs-identifier hs-var">interpretExpr'</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b c.
Monad m =&gt;
(a -&gt; m b) -&gt; (b -&gt; m c) -&gt; a -&gt; m c
</span><span class="hs-operator hs-var">&gt;=&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall s. RuntimeValue s -&gt; Result s Bool
</span><a href="Interpreter.Interpreter.html#castToBool"><span class="hs-identifier hs-var">castToBool</span></a></span><span>
</span><span id="line-270"></span><span>
</span><span id="line-271"></span><span id="local-6989586621679168920"><span class="annot"><a href="Interpreter.Interpreter.html#interpretArrExpr"><span class="hs-identifier hs-type">interpretArrExpr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Analyzer.AnalyzedAst.html#Expression"><span class="hs-identifier hs-type">Ast.Expression</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Interpreter.Result.html#Result"><span class="hs-identifier hs-type">Result</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679168920"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Interpreter.Result.html#RuntimeValue"><span class="hs-identifier hs-type">RuntimeValue</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679168920"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">]</span></span><span>
</span><span id="line-272"></span><span id="interpretArrExpr"><span class="annot"><span class="annottext">interpretArrExpr :: forall s. Expression -&gt; Result s [RuntimeValue s]
</span><a href="Interpreter.Interpreter.html#interpretArrExpr"><span class="hs-identifier hs-var hs-var">interpretArrExpr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall s. Expression -&gt; Result s (RuntimeValue s)
</span><a href="Interpreter.Interpreter.html#interpretExpr%27"><span class="hs-identifier hs-var">interpretExpr'</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b c.
Monad m =&gt;
(a -&gt; m b) -&gt; (b -&gt; m c) -&gt; a -&gt; m c
</span><span class="hs-operator hs-var">&gt;=&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall s. RuntimeValue s -&gt; Result s [RuntimeValue s]
</span><a href="Interpreter.Interpreter.html#castToArr"><span class="hs-identifier hs-var">castToArr</span></a></span><span>
</span><span id="line-273"></span><span>
</span><span id="line-274"></span><span id="local-6989586621679168914"><span class="annot"><a href="Interpreter.Interpreter.html#interpretFuncExpr"><span class="hs-identifier hs-type">interpretFuncExpr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Analyzer.AnalyzedAst.html#Expression"><span class="hs-identifier hs-type">Ast.Expression</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Interpreter.Result.html#Result"><span class="hs-identifier hs-type">Result</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679168914"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Analyzer.AnalyzedAst.html#Function"><span class="hs-identifier hs-type">Ast.Function</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Interpreter.Result.html#Scope"><span class="hs-identifier hs-type">Scope</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679168914"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-275"></span><span id="interpretFuncExpr"><span class="annot"><span class="annottext">interpretFuncExpr :: forall s. Expression -&gt; Result s (Function, Scope s)
</span><a href="Interpreter.Interpreter.html#interpretFuncExpr"><span class="hs-identifier hs-var hs-var">interpretFuncExpr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall s. Expression -&gt; Result s (RuntimeValue s)
</span><a href="Interpreter.Interpreter.html#interpretExpr%27"><span class="hs-identifier hs-var">interpretExpr'</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b c.
Monad m =&gt;
(a -&gt; m b) -&gt; (b -&gt; m c) -&gt; a -&gt; m c
</span><span class="hs-operator hs-var">&gt;=&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall s. RuntimeValue s -&gt; Result s (Function, Scope s)
</span><a href="Interpreter.Interpreter.html#castToFunc"><span class="hs-identifier hs-var">castToFunc</span></a></span><span>
</span><span id="line-276"></span><span>
</span><span id="line-277"></span><span id="local-6989586621679169074"><span class="annot"><a href="Interpreter.Interpreter.html#interpretExpr%27"><span class="hs-identifier hs-type">interpretExpr'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Analyzer.AnalyzedAst.html#Expression"><span class="hs-identifier hs-type">Ast.Expression</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Interpreter.Result.html#Result"><span class="hs-identifier hs-type">Result</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679169074"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Interpreter.Result.html#RuntimeValue"><span class="hs-identifier hs-type">RuntimeValue</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679169074"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-278"></span><span id="interpretExpr%27"><span class="annot"><span class="annottext">interpretExpr' :: forall s. Expression -&gt; Result s (RuntimeValue s)
</span><a href="Interpreter.Interpreter.html#interpretExpr%27"><span class="hs-identifier hs-var hs-var">interpretExpr'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall s. Expression -&gt; Result s (MaybeVoid (RuntimeValue s))
</span><a href="Interpreter.Interpreter.html#interpretExpr"><span class="hs-identifier hs-var">interpretExpr</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b c.
Monad m =&gt;
(a -&gt; m b) -&gt; (b -&gt; m c) -&gt; a -&gt; m c
</span><span class="hs-operator hs-var">&gt;=&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall a s. MaybeVoid a -&gt; Result s a
</span><a href="Interpreter.Interpreter.html#unwrapJust"><span class="hs-identifier hs-var">unwrapJust</span></a></span><span>
</span><span id="line-279"></span><span>
</span><span id="line-280"></span><span id="local-6989586621679168905"><span id="local-6989586621679168906"><span class="annot"><a href="Interpreter.Interpreter.html#unwrapJust"><span class="hs-identifier hs-type">unwrapJust</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="MaybeVoid.html#MaybeVoid"><span class="hs-identifier hs-type">MaybeVoid</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679168906"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Interpreter.Result.html#Result"><span class="hs-identifier hs-type">Result</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679168905"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679168906"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-281"></span><span id="unwrapJust"><span class="annot"><span class="annottext">unwrapJust :: forall a s. MaybeVoid a -&gt; Result s a
</span><a href="Interpreter.Interpreter.html#unwrapJust"><span class="hs-identifier hs-var hs-var">unwrapJust</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall b a. b -&gt; (a -&gt; b) -&gt; MaybeVoid a -&gt; b
</span><a href="MaybeVoid.html#maybeVoid"><span class="hs-identifier hs-var">maybeVoid</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">Err
</span><a href="Interpreter.Result.html#UnexpectedError"><span class="hs-identifier hs-var">UnexpectedError</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span>
</span><span id="line-282"></span><span>
</span><span id="line-283"></span><span class="hs-comment">-- ** Primitive values</span><span>
</span><span id="line-284"></span><span>
</span><span id="line-285"></span><span id="local-6989586621679168927"><span class="annot"><a href="Interpreter.Interpreter.html#valueToPrimitive"><span class="hs-identifier hs-type">valueToPrimitive</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Interpreter.Result.html#RuntimeValue"><span class="hs-identifier hs-type">RuntimeValue</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679168927"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Interpreter.Result.html#Result"><span class="hs-identifier hs-type">Result</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679168927"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PrimitiveValue.html#PrimitiveValue"><span class="hs-identifier hs-type">PV.PrimitiveValue</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span></span><span>
</span><span id="line-286"></span><span id="valueToPrimitive"><span class="annot"><span class="annottext">valueToPrimitive :: forall s. RuntimeValue s -&gt; Result s (PrimitiveValue Int)
</span><a href="Interpreter.Interpreter.html#valueToPrimitive"><span class="hs-identifier hs-var hs-var">valueToPrimitive</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-287"></span><span>  </span><span class="annot"><a href="Interpreter.Result.html#ValInt"><span class="hs-identifier hs-type">ValInt</span></a></span><span> </span><span id="local-6989586621679168272"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679168272"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall num. num -&gt; PrimitiveValue num
</span><a href="PrimitiveValue.html#PrimNum"><span class="hs-identifier hs-var">PV.PrimNum</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679168272"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-288"></span><span>  </span><span class="annot"><a href="Interpreter.Result.html#ValBool"><span class="hs-identifier hs-type">ValBool</span></a></span><span> </span><span id="local-6989586621679168270"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679168270"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall num. Bool -&gt; PrimitiveValue num
</span><a href="PrimitiveValue.html#PrimBool"><span class="hs-identifier hs-var">PV.PrimBool</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679168270"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-289"></span><span>  </span><span class="annot"><a href="Interpreter.Result.html#ValString"><span class="hs-identifier hs-type">ValString</span></a></span><span> </span><span id="local-6989586621679168268"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679168268"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall num. Text -&gt; PrimitiveValue num
</span><a href="PrimitiveValue.html#PrimString"><span class="hs-identifier hs-var">PV.PrimString</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679168268"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-290"></span><span>  </span><span class="annot"><span class="annottext">RuntimeValue s
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">Err
</span><a href="Interpreter.Result.html#UnexpectedError"><span class="hs-identifier hs-var">UnexpectedError</span></a></span><span>
</span><span id="line-291"></span><span>
</span><span id="line-292"></span><span id="local-6989586621679168925"><span class="annot"><a href="Interpreter.Interpreter.html#liftPV"><span class="hs-identifier hs-type">liftPV</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="PrimitiveValue.html#Err"><span class="hs-identifier hs-type">PV.Err</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PrimitiveValue.html#PrimitiveValue"><span class="hs-identifier hs-type">PV.PrimitiveValue</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Interpreter.Result.html#Result"><span class="hs-identifier hs-type">Result</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679168925"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="MaybeVoid.html#MaybeVoid"><span class="hs-identifier hs-type">MaybeVoid</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Interpreter.Result.html#RuntimeValue"><span class="hs-identifier hs-type">RuntimeValue</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679168925"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span><span>
</span><span id="line-293"></span><span id="liftPV"><span class="annot"><span class="annottext">liftPV :: forall s.
Either Err (PrimitiveValue Int)
-&gt; Result s (MaybeVoid (RuntimeValue s))
</span><a href="Interpreter.Interpreter.html#liftPV"><span class="hs-identifier hs-var hs-var">liftPV</span></a></span></span><span> </span><span id="local-6989586621679168263"><span class="annot"><span class="annottext">Either Err (PrimitiveValue Int)
</span><a href="#local-6989586621679168263"><span class="hs-identifier hs-var">pvRes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall e (m :: * -&gt; *) a. MonadError e m =&gt; Either e a -&gt; m a
</span><span class="hs-identifier hs-var">liftEither</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall a c b d. (a -&gt; c) -&gt; (b -&gt; d) -&gt; Either a b -&gt; Either c d
</span><span class="hs-identifier hs-var">mapBoth</span></span><span> </span><span class="annot"><span class="annottext">Err -&gt; Err
</span><a href="#local-6989586621679168262"><span class="hs-identifier hs-var">mapErr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; MaybeVoid a
</span><a href="MaybeVoid.html#NonVoid"><span class="hs-identifier hs-var">NonVoid</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall {s}. PrimitiveValue Int -&gt; RuntimeValue s
</span><a href="#local-6989586621679168261"><span class="hs-identifier hs-var">primitiveToValue</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Either Err (PrimitiveValue Int)
</span><a href="#local-6989586621679168263"><span class="hs-identifier hs-var">pvRes</span></a></span><span>
</span><span id="line-294"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-295"></span><span>    </span><span id="local-6989586621679168262"><span class="annot"><span class="annottext">mapErr :: Err -&gt; Err
</span><a href="#local-6989586621679168262"><span class="hs-identifier hs-var hs-var">mapErr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-296"></span><span>      </span><span class="annot"><span class="annottext">Err
</span><a href="PrimitiveValue.html#MismatchedTypes"><span class="hs-identifier hs-var">PV.MismatchedTypes</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Err
</span><a href="Interpreter.Result.html#UnexpectedError"><span class="hs-identifier hs-var">UnexpectedError</span></a></span><span>
</span><span id="line-297"></span><span>      </span><span class="annot"><span class="annottext">Err
</span><a href="PrimitiveValue.html#DivisionByZero"><span class="hs-identifier hs-var">PV.DivisionByZero</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Err
</span><a href="Interpreter.Result.html#DivisionByZero"><span class="hs-identifier hs-var">DivisionByZero</span></a></span><span>
</span><span id="line-298"></span><span>
</span><span id="line-299"></span><span>    </span><span id="local-6989586621679168261"><span class="annot"><span class="annottext">primitiveToValue :: PrimitiveValue Int -&gt; RuntimeValue s
</span><a href="#local-6989586621679168261"><span class="hs-identifier hs-var hs-var">primitiveToValue</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-300"></span><span>      </span><span class="annot"><a href="PrimitiveValue.html#PrimNum"><span class="hs-identifier hs-type">PV.PrimNum</span></a></span><span> </span><span id="local-6989586621679168257"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679168257"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall s. Int -&gt; RuntimeValue s
</span><a href="Interpreter.Result.html#ValInt"><span class="hs-identifier hs-var">ValInt</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679168257"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-301"></span><span>      </span><span class="annot"><a href="PrimitiveValue.html#PrimBool"><span class="hs-identifier hs-type">PV.PrimBool</span></a></span><span> </span><span id="local-6989586621679168256"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679168256"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall s. Bool -&gt; RuntimeValue s
</span><a href="Interpreter.Result.html#ValBool"><span class="hs-identifier hs-var">ValBool</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679168256"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-302"></span><span>      </span><span class="annot"><a href="PrimitiveValue.html#PrimString"><span class="hs-identifier hs-type">PV.PrimString</span></a></span><span> </span><span id="local-6989586621679168255"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679168255"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall s. Text -&gt; RuntimeValue s
</span><a href="Interpreter.Result.html#ValString"><span class="hs-identifier hs-var">ValString</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679168255"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-303"></span><span>
</span><span id="line-304"></span><span class="hs-comment">-- ** Cast runtime values</span><span>
</span><span id="line-305"></span><span>
</span><span id="line-306"></span><span id="local-6989586621679168975"><span class="annot"><a href="Interpreter.Interpreter.html#castToInt"><span class="hs-identifier hs-type">castToInt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Interpreter.Result.html#RuntimeValue"><span class="hs-identifier hs-type">RuntimeValue</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679168975"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Interpreter.Result.html#Result"><span class="hs-identifier hs-type">Result</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679168975"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span></span><span>
</span><span id="line-307"></span><span id="castToInt"><span class="annot"><span class="annottext">castToInt :: forall s. RuntimeValue s -&gt; Result s Int
</span><a href="Interpreter.Interpreter.html#castToInt"><span class="hs-identifier hs-var hs-var">castToInt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-308"></span><span>  </span><span class="annot"><a href="Interpreter.Result.html#ValInt"><span class="hs-identifier hs-type">ValInt</span></a></span><span> </span><span id="local-6989586621679168250"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679168250"><span class="hs-identifier hs-var">int</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679168250"><span class="hs-identifier hs-var">int</span></a></span><span>
</span><span id="line-309"></span><span>  </span><span class="annot"><span class="annottext">RuntimeValue s
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">Err
</span><a href="Interpreter.Result.html#UnexpectedError"><span class="hs-identifier hs-var">UnexpectedError</span></a></span><span>
</span><span id="line-310"></span><span>
</span><span id="line-311"></span><span id="local-6989586621679168911"><span class="annot"><a href="Interpreter.Interpreter.html#castToBool"><span class="hs-identifier hs-type">castToBool</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Interpreter.Result.html#RuntimeValue"><span class="hs-identifier hs-type">RuntimeValue</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679168911"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Interpreter.Result.html#Result"><span class="hs-identifier hs-type">Result</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679168911"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span><span>
</span><span id="line-312"></span><span id="castToBool"><span class="annot"><span class="annottext">castToBool :: forall s. RuntimeValue s -&gt; Result s Bool
</span><a href="Interpreter.Interpreter.html#castToBool"><span class="hs-identifier hs-var hs-var">castToBool</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-313"></span><span>  </span><span class="annot"><a href="Interpreter.Result.html#ValBool"><span class="hs-identifier hs-type">ValBool</span></a></span><span> </span><span id="local-6989586621679168245"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679168245"><span class="hs-identifier hs-var">bool</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679168245"><span class="hs-identifier hs-var">bool</span></a></span><span>
</span><span id="line-314"></span><span>  </span><span class="annot"><span class="annottext">RuntimeValue s
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">Err
</span><a href="Interpreter.Result.html#UnexpectedError"><span class="hs-identifier hs-var">UnexpectedError</span></a></span><span>
</span><span id="line-315"></span><span>
</span><span id="line-316"></span><span id="local-6989586621679168961"><span class="annot"><a href="Interpreter.Interpreter.html#castToArr"><span class="hs-identifier hs-type">castToArr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Interpreter.Result.html#RuntimeValue"><span class="hs-identifier hs-type">RuntimeValue</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679168961"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Interpreter.Result.html#Result"><span class="hs-identifier hs-type">Result</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679168961"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Interpreter.Result.html#RuntimeValue"><span class="hs-identifier hs-type">RuntimeValue</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679168961"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">]</span></span><span>
</span><span id="line-317"></span><span id="castToArr"><span class="annot"><span class="annottext">castToArr :: forall s. RuntimeValue s -&gt; Result s [RuntimeValue s]
</span><a href="Interpreter.Interpreter.html#castToArr"><span class="hs-identifier hs-var hs-var">castToArr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-318"></span><span>  </span><span class="annot"><a href="Interpreter.Result.html#ValArray"><span class="hs-identifier hs-type">ValArray</span></a></span><span> </span><span id="local-6989586621679168240"><span class="annot"><span class="annottext">[RuntimeValue s]
</span><a href="#local-6989586621679168240"><span class="hs-identifier hs-var">arr</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">[RuntimeValue s]
</span><a href="#local-6989586621679168240"><span class="hs-identifier hs-var">arr</span></a></span><span>
</span><span id="line-319"></span><span>  </span><span class="annot"><span class="annottext">RuntimeValue s
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">Err
</span><a href="Interpreter.Result.html#UnexpectedError"><span class="hs-identifier hs-var">UnexpectedError</span></a></span><span>
</span><span id="line-320"></span><span>
</span><span id="line-321"></span><span id="local-6989586621679168908"><span class="annot"><a href="Interpreter.Interpreter.html#castToFunc"><span class="hs-identifier hs-type">castToFunc</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Interpreter.Result.html#RuntimeValue"><span class="hs-identifier hs-type">RuntimeValue</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679168908"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Interpreter.Result.html#Result"><span class="hs-identifier hs-type">Result</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679168908"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Analyzer.AnalyzedAst.html#Function"><span class="hs-identifier hs-type">Ast.Function</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Interpreter.Result.html#Scope"><span class="hs-identifier hs-type">Scope</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679168908"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-322"></span><span id="castToFunc"><span class="annot"><span class="annottext">castToFunc :: forall s. RuntimeValue s -&gt; Result s (Function, Scope s)
</span><a href="Interpreter.Interpreter.html#castToFunc"><span class="hs-identifier hs-var hs-var">castToFunc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-323"></span><span>  </span><span class="annot"><a href="Interpreter.Result.html#ValFunction"><span class="hs-identifier hs-type">ValFunction</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Analyzer.AnalyzedAst.html#Function"><span class="hs-identifier hs-type">Ast.Function</span></a></span><span> </span><span id="local-6989586621679168233"><span class="annot"><span class="annottext">Function
</span><a href="#local-6989586621679168233"><span class="hs-identifier hs-var">f</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679168232"><span class="annot"><span class="annottext">Scope s
</span><a href="#local-6989586621679168232"><span class="hs-identifier hs-var">sc</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Function
</span><a href="#local-6989586621679168233"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Scope s
</span><a href="#local-6989586621679168232"><span class="hs-identifier hs-var">sc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-324"></span><span>  </span><span class="annot"><a href="Interpreter.Result.html#ValFunction"><span class="hs-identifier hs-type">ValFunction</span></a></span><span> </span><span class="annot"><span class="annottext">FunctionValue
</span><a href="Analyzer.AnalyzedAst.html#Nil"><span class="hs-identifier hs-var">Ast.Nil</span></a></span><span> </span><span class="annot"><span class="annottext">Scope s
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">Err
</span><a href="Interpreter.Result.html#Npe"><span class="hs-identifier hs-var">Npe</span></a></span><span>
</span><span id="line-325"></span><span>  </span><span class="annot"><span class="annottext">RuntimeValue s
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">Err
</span><a href="Interpreter.Result.html#UnexpectedError"><span class="hs-identifier hs-var">UnexpectedError</span></a></span><span>
</span><span id="line-326"></span></pre></body></html>